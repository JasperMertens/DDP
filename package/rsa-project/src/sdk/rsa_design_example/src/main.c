#include <stdio.h>
#include <stdlib.h>

#include "xil_printf.h"
#include "xil_cache.h"

#include "platform/platform.h"
#include "platform/performance_counters.h"

#include "interface.h"
#include "sw.h"
#include "hw.h"

///////////////////////////////////////////////////////////
#include "montgomery2.h"
///////////////////////////////////////////////////////////

// These variables are defined and assigned in testvector.c
extern uint32_t M[32],
                N[32],       N_prime[32],
                e[32],
                e_len,
                p[16],       q[16],
                d_p[16],     d_q[16],
                d_p_len, d_q_len,
                x_p[32],     x_q[32],
				Rp[16],		Rq[16],
                R2p[16],     R2q[16],
                R_1024[32],  R2_1024[32],
                One[32],
				Ciphertext[32],
				Ciphertext_p[16], Ciphertext_q[16],
				Plaintext_p[32], Plaintext_q[32],
				Plaintext[32];


// Note that these tree CMDs are same as
// they are defined in montgomery_wrapper.v
#define CMD_READ    0
#define CMD_COMPUTE 1
#define CMD_WRITE   2

void test_mp_sub();
void test_mp_add();
void test_mod_add();
void test_mont_mult();
void test_mont_exp();
void printMontResult();
void test_hw_mont_mult();
void test_hw_mont_exp();
void test_reduce_cipher();
void test_combine_result();
void test_hw_mont_decrypt();

uint32_t result[32] = {0};
uint32_t size = 32;


int main()
{

    init_platform();
    init_performance_counters(1);
    interface_init();

    xil_printf("\n\r Startup..\n\r");

    START_TIMING

	//test_dma_transfer();

	//test_mp_add();

	//test_mp_sub();

	//test_mod_add();
    
    //test_mont_mult();

	//test_hw_mont_mult();

    //test_mont_exp();

	//test_hw_mont_exp();

	//test_reduce_cipher();

    //test_combine_result();

	test_hw_mont_decrypt();

    STOP_TIMING

    ////////////// Test the port-based communication //////////////

	//// --- Create and initialize src array

#if NUMBER_OF_CORES == 1
	// If NUMBER_OF_CORES == 1
	// then all 16 words defined below will be used to communicate with Core 1

	unsigned int src[DMA_TRANSFER_NUMBER_OF_WORDS]={
		0x00000000, 0x00000000, 0x01234567, 0x89abcdef,
		0x00000000, 0x00000000, 0x00000000, 0x00000000,
		0x00000000, 0x00000000, 0x00000000, 0x00000000,
		0x00000000, 0x00000000, 0x00000000, 0x00000000};
#else
    // If NUMBER_OF_CORES == 2
    // then 32 words will be defined,
    //      the words  0 to 15 will be used to communicate with Core 1
    //      the words 16 to 31 will be used to communicate with Core 2

    unsigned int src[DMA_TRANSFER_NUMBER_OF_WORDS]={
		0x00000000, 0x00000000, 0x00000000, 0x00000000,
		0x00000000, 0x00000000, 0x00000000, 0x00000000,
		0x00000000, 0x00000000, 0x00000000, 0x00000000,
		0x76543210, 0xfedcba98, 0x00000000, 0x00000000,

		0x00000000, 0x00000000, 0x00000000, 0x00000000,
		0x00000000, 0x00000000, 0x00000000, 0x00000000,
		0x00000000, 0x00000000, 0x00000000, 0x00000000,
		0x89abcdef, 0x01234567, 0x00000000, 0x00000000};

    // If you need, you can use the src1 and src2 pointers
    // to access the src array defined above as two individual arrays.
    // src1 for the lower  16-words of the src array and
    // src2 for the higher 16-words
    unsigned int* src1 = src;
    unsigned int* src2 = src+16;
#endif
    //// --- Perform the send operation
//
//    // Start by writing CMD_READ to port1 (command port)
//    xil_printf("PORT1=%x\n\r",CMD_READ);
//    my_montgomery_port[0] = CMD_READ;
//
//    // Transfer the src array to BRAM
//    bram_dma_transfer(dma_config,src,DMA_TRANSFER_NUMBER_OF_WORDS);
//
//    // Wait for done of CMD_READ is done
//    // by waiting for port2 (acknowledgement port)
//    port2_wait_for_done();
//
//
//    //// --- Print BRAM contents
//
//    // For checking if send is successful
//    print_bram_contents();
//
//
////    //// --- Perform the compute operation
////
////    // Start by writing CMD_COMPUTE to port1 (command port)
////    xil_printf("PORT1=%x\n\r",CMD_COMPUTE);
////    my_montgomery_port[0] = CMD_COMPUTE;
////
////    // Wait for done of CMD_COMPUTE is done
////	// by waiting for port2 (aknowledgement port)
////    port2_wait_for_done();
//
//
//    //// --- Perform the read operation
//
//    // Start by writing CMD_WRITE to port1 (command port)
//    xil_printf("PORT1=%x\n\r",CMD_WRITE);
//    my_montgomery_port[0] = 5;
//
//    // Wait for done of CMD_WRITE is done
//    port2_wait_for_done(); //Wait until Port2=1
//
//
//    //// --- Print BRAM contents
//
//    // For receiving the read output of the computation
//    print_bram_contents();

    cleanup_platform();

    return 0;
}

void test_mod_add() {
	// mod add in reduction p with seed 2017.5
	uint32_t Ct_h[16] = {0x24edc7cb, 0x5f7b06f3, 0xf95a4326, 0x146275dc, 0x37d3967d, 0x0fdac629, 0x69f9296f, 0xbf7b3444, 0x9b4e069b, 0xb3b2dbe4, 0x453de278, 0x9ec53891, 0x6889ffc8, 0xed432111, 0xd4912772, 0x60f4e9a4};
	uint32_t Ct_l[16] = {0x19165bf2, 0x1a1e07ac, 0xa710d7e8, 0x8a73ce23, 0xf0e74c50, 0x45314e0f, 0x7d208d38, 0x56b2d58d, 0x26f4443b, 0x77e3874f, 0x77414fb2, 0x001c768a, 0x9d3866bb, 0x6bea2e7a, 0x67772f96, 0xd805b8f2};
	uint32_t M[16] = {0xb4d8c50d, 0xab2d4239, 0xcc52c6bd, 0xbcfc0dc9, 0x06e74d5b, 0x51c9419e, 0x2b625fbe, 0x27752c42, 0xa2e6ed3d, 0x466e8aa1, 0xd6cd644d, 0xc8b75f23, 0xcbb78fe1, 0x5fe14b0c, 0x838da10f, 0x884fb732};
	uint32_t expected_output[16] = {0xd45299a3, 0x233e8a2b, 0x07c58d93, 0x24de286d, 0x1aec4816, 0xb17990fd, 0x9054f72a, 0xc743b14d, 0x7c74705c, 0x9eb94df0, 0x0ee46990, 0x0d72f0d4, 0x6e5346c0, 0x996ab972, 0x34ed14ea, 0x285b3432};

	mod_add(Ct_h , Ct_l, M, result, 16);

	xil_printf("\r\n");
	printMontResult(16);
	xil_printf("Expected ");
	printArray(expected_output, 16);

	if (memcmp(result, expected_output, 16) != 0) {
		xil_printf("Mod add failed\r\n");
		abort();
	}

	xil_printf("Mod add succeeded\r\n");
}


void test_mont_mult() {

#define MULT_TESTVECTOR 5

	#if MULT_TESTVECTOR == 1
	uint32_t a[32] = 				{0xf484e847, 0x4ae251f1, 0xedfa617d, 0x58ab6bf4, 0x46bf4848, 0xf67c1061, 0x8811c17a, 0x578fde16, 0x493ee595, 0x1eafc4c3, 0xc4f11a2e, 0x8cb6fba7, 0x724c03a4, 0x2e6c1dbd, 0x57ebc43d, 0x3e6ee260, 0x4089c050, 0xf0384e03, 0x7357f72c, 0x87acb658, 0x7ea2490e, 0x61069112, 0x42e3f8b9, 0x9e778cef, 0x5cdf77c7, 0x10bce41c, 0x1121beec, 0x3db59a36, 0xc34620c5, 0xc6b030ae, 0xe8fc5934, 0x63a0a0cb};
	uint32_t b[32] = 				{0xfeb1b9f4, 0xe91d3bec, 0xfb09354d, 0x07f21d6d, 0x9ece9e1b, 0x18def18b, 0x4119e1e9, 0x55c85f24, 0x60ef0e23, 0x10e8ab54, 0x1e95cdcc, 0x4373912f, 0x6f42204d, 0x7126650d, 0xb61c1c8d, 0x98af9011, 0xa42c03b4, 0xd29e0870, 0x7923cb60, 0xdf87cfe5, 0xde4fffa0, 0x3ce537ca, 0x201040c6, 0x6e54b058, 0x814c53dc, 0xf16243f0, 0x57decf64, 0x8d0d4f37, 0x9b6d93e5, 0x45396d71, 0x615213c4, 0x65f89f9f};
	uint32_t N[32] = 				{0x4aeeb107, 0x5d78aa98, 0x6c55dd05, 0x6f5326c9, 0xf93f738c, 0xc10fa093, 0x20478120, 0x099d6d70, 0x833d9b82, 0x1248f3ed, 0xa43ed737, 0xc1c1da45, 0x9f23e5c7, 0xb17c3598, 0xe8938df6, 0x7ae59036, 0x9f84d87b, 0xc8710dc6, 0x249ee0f8, 0x46eeae2f, 0x66a3bb9b, 0xfeef4c6b, 0xc7b55eae, 0x7951dd0c, 0x0b4391e8, 0x141ad586, 0x1a568588, 0x908293dd, 0x472c0bea, 0x8d00abfe, 0xed17377f, 0x83a01efe};
	uint32_t n_prime[32] = 			{0xe7d41349, 0x0c828dcd, 0x2dc06d90, 0x318f87bf, 0x1992ba09, 0x4b1bef10, 0x011ba664, 0xe3a7d9cf, 0x44449fbd, 0x89714d34, 0x6cd49cc4, 0x49c5b99d, 0xf90435b1, 0x38f037b7, 0xba9720db, 0x9641b106, 0xbca01d2a, 0xfdb82893, 0xbd7ce9c7, 0x372823e1, 0x4901cdde, 0xaa28d457, 0xe9f78c94, 0xb6e1e5b3, 0x5a79f7a6, 0xf5212a83, 0x2b1aab45, 0xa3924b69, 0x3c63a8af, 0x12fa121d, 0x7500bea0, 0xe58878e7};
	uint32_t expected_output[32] = 	{0xeb7e3ef3, 0x40b90c4f, 0xd9c234b1, 0x2461cd34, 0x183481c7, 0x0bc4e5bd, 0x4803996e, 0x755d1777, 0x698f88c7, 0x2e78b03b, 0xa55cfb32, 0x74d1c12a, 0xc6bc8934, 0x581d4714, 0x7d504a58, 0xb29753f1, 0x99ae0c37, 0x65c4cc3a, 0x4153aacb, 0xe0a5c4bf, 0xce0a9c7c, 0x4babfb22, 0x75aa490d, 0x43b6ec25, 0xdcb17a10, 0x47deec3c, 0xd0e2735f, 0x16726b8e, 0x0f486246, 0x0f74d471, 0xe62a3577, 0x065a0397};

	#elif MULT_TESTVECTOR == 2
    uint32_t a[32] = 				{0x95401e33, 0xf2e5f538, 0xcd340e16, 0x5fe4fd66, 0xac500fe0, 0x748f18fe, 0xdad8575e, 0xce2058bb, 0x00c35266, 0xd51c8064, 0xfefeb38e, 0xc7ed29eb, 0xdb438313, 0x6550e48e, 0x02489732, 0xedaf8b6b, 0x5dd5313d, 0xa328f036, 0x419a784e, 0x23d635bb, 0x25143077, 0x48996382, 0xaa396499, 0xf24a2910, 0xb60ee4dc, 0xdfede44c, 0x69f174f6, 0x917d544c, 0x3c80aecf, 0xc90096c4, 0xc52a6c88, 0x07d92c14};
    uint32_t b[32] = 				{0xd7040630, 0xc765f25a, 0x4a7230d6, 0x395c2b8b, 0xaec10e86, 0xb62173f6, 0x72096da0, 0xc0ed3b81, 0x240e4293, 0xac5a2199, 0x5d05fed8, 0xadcae3e6, 0x22704082, 0x3b74cdb2, 0x51f0df68, 0xde5b7e6f, 0x66dc5f67, 0x0a836d5e, 0x32edcdb9, 0x4332989f, 0xedef232c, 0x25167785, 0x34d884aa, 0xfdf337de, 0xd7532d14, 0xa4b160f1, 0xf833b81c, 0xaa9589fb, 0xef7f7ade, 0x6ccff27d, 0x747a7bb0, 0x1f8042e7};
    uint32_t N[32] = 				{0xc6df4c85, 0x08e49be7, 0xe6f266e4, 0x450ca4b0, 0x028def7e, 0x3bdf79cf, 0xd3c65a9b, 0xd278192c, 0x08fd96bf, 0x5d635e17, 0xac3f28b1, 0x8449d487, 0xdd42688c, 0x61419fe8, 0x6b674328, 0x8f6bd9e2, 0x8e47420e, 0x94711c9e, 0x22f7165a, 0x2485755e, 0x61561df6, 0xf664e91d, 0xd97d05ce, 0xf221e0fd, 0xfd772f68, 0xf1856267, 0xe9041ac4, 0x2fd12fc8, 0x34b9220f, 0x695e5d77, 0x6b079c2c, 0x86ad4952};
    uint32_t n_prime[32] = 			{0x14d333b3, 0xc3b3be8f, 0x02ca4af0, 0xc43aba10, 0xde20e9cb, 0xc88222f9, 0x80860cc0, 0x315e4cf8, 0x0a2cc4f4, 0x16376d50, 0xcc1720b7, 0x8af0c35b, 0xc3ece9e9, 0x8f01dccc, 0x42d96568, 0xc02be3a4, 0x71e50c92, 0xb050887c, 0x4df93c3d, 0x75a13c65, 0xcd504fe2, 0x99ac5e4c, 0xc9f348e7, 0xb95f9a0e, 0xe170a1f0, 0x4769f246, 0x913001b4, 0xfc05df41, 0x63dc5efb, 0x9a863fbe, 0xc1f39f28, 0xf1295524};
    uint32_t expected_output[32] = 	{0xe4a627f2, 0x44ced61c, 0xb41445b2, 0x1deec41a, 0x00ec59c6, 0x366243e9, 0x8b3a5383, 0x293a279e, 0xb57482b8, 0x28a49995, 0xd5012ddd, 0xa1427bbf, 0xa4586c9c, 0x7df6bde0, 0x923e818c, 0xe215dbb8, 0x3a62ed6c, 0xe0f76529, 0x2d2936f3, 0x54e7fa14, 0x18022409, 0x6d5160c4, 0x998fe1c4, 0x86dab2c2, 0x46eda221, 0x6f93d1e2, 0xe9e57d26, 0xfb42688f, 0x679e9aa1, 0x6b70806a, 0x85d91b9f, 0x6a7decd7};

	#elif MULT_TESTVECTOR == 3
    uint32_t a[32] = 				{0x83bfde37, 0x4bb9caee, 0xa4b7bc55, 0x96e8674e, 0xaf6bbfe8, 0x0a527da7, 0xf7bc7ea0, 0xb699b8a8, 0x3920848d, 0xaeaf012f, 0x66ebd8c2, 0x5abead95, 0xae5a687b, 0x665240f4, 0x09cda19d, 0x44c26595, 0x9ab850d6, 0x18558d44, 0xf1bb0229, 0x76b9a3c1, 0x57e32029, 0x754ab74d, 0x67a4d489, 0xe225cb67, 0xaf4e9389, 0xe6487bd9, 0x6192265a, 0x2b91e006, 0xb603722b, 0x6b7d9fc5, 0xb23c36b6, 0xc9d91b54};
	uint32_t b[32] = 				{0x83bfde37, 0x4bb9caee, 0xa4b7bc55, 0x96e8674e, 0xaf6bbfe8, 0x0a527da7, 0xf7bc7ea0, 0xb699b8a8, 0x3920848d, 0xaeaf012f, 0x66ebd8c2, 0x5abead95, 0xae5a687b, 0x665240f4, 0x09cda19d, 0x44c26595, 0x9ab850d6, 0x18558d44, 0xf1bb0229, 0x76b9a3c1, 0x57e32029, 0x754ab74d, 0x67a4d489, 0xe225cb67, 0xaf4e9389, 0xe6487bd9, 0x6192265a, 0x2b91e006, 0xb603722b, 0x6b7d9fc5, 0xb23c36b6, 0xc9d91b54};
	uint32_t N[32] = 				{0x3b6021e5, 0x134c079f, 0xfde33b8f, 0xbaab11a1, 0x3c8c893c, 0xb1500200, 0xf9d24bba, 0xe222d5c3, 0x6cac296c, 0xb98e5642, 0x673bb3df, 0xbf622e6f, 0xcde92e10, 0x5b70b0f8, 0xbc0af8ba, 0x26111490, 0x930334b9, 0x66277177, 0x0e5f81f5, 0x7bfcaf4b, 0x8411f03a, 0xd0173f99, 0xd32ec72e, 0x53bdcc72, 0xcff9bece, 0x9aa667a9, 0x6fe3a78c, 0x02c749b4, 0xb1097967, 0x590ecd2d, 0x47583048, 0xd6369bca};
	uint32_t n_prime[1] = 			{0xb7bfcc13};
	uint32_t expected_output[32] = 	{0x32d84340, 0x3a3e6880, 0x3f632a75, 0x2ed7d896, 0x4e8177d9, 0x74458b42, 0xad6a9b6c, 0x25fc5bf2, 0x03217fcb, 0xd6d9ba7c, 0x29d1d141, 0xb156774f, 0x50731532, 0x46db2146, 0xb410bf5d, 0x3f048b1b, 0xeaa83826, 0x30eaf592, 0xd90cd3ff, 0xe8c4c0c3, 0xfe763e67, 0x742f8f31, 0xe2f7181d, 0x546dd84a, 0xad7bd802, 0x8848727c, 0x5204c8d5, 0x15cc471f, 0x06c461a6, 0x758f0bb4, 0x0af98f85, 0x49f887aa};

	#elif MULT_TESTVECTOR == 4
	uint32_t a[32] = 				{0xf484e847, 0x4ae251f1, 0xedfa617d, 0x58ab6bf4, 0x46bf4848, 0xf67c1061, 0x8811c17a, 0x578fde16, 0x493ee595, 0x1eafc4c3, 0xc4f11a2e, 0x8cb6fba7, 0x724c03a4, 0x2e6c1dbd, 0x57ebc43d, 0x3e6ee260, 0x4089c050, 0xf0384e03, 0x7357f72c, 0x87acb658, 0x7ea2490e, 0x61069112, 0x42e3f8b9, 0x9e778cef, 0x5cdf77c7, 0x10bce41c, 0x1121beec, 0x3db59a36, 0xc34620c5, 0xc6b030ae, 0xe8fc5934, 0x63a0a0cb};
	uint32_t b[32] = 				{0xfeb1b9f4, 0xe91d3bec, 0xfb09354d, 0x07f21d6d, 0x9ece9e1b, 0x18def18b, 0x4119e1e9, 0x55c85f24, 0x60ef0e23, 0x10e8ab54, 0x1e95cdcc, 0x4373912f, 0x6f42204d, 0x7126650d, 0xb61c1c8d, 0x98af9011, 0xa42c03b4, 0xd29e0870, 0x7923cb60, 0xdf87cfe5, 0xde4fffa0, 0x3ce537ca, 0x201040c6, 0x6e54b058, 0x814c53dc, 0xf16243f0, 0x57decf64, 0x8d0d4f37, 0x9b6d93e5, 0x45396d71, 0x615213c4, 0x65f89f9f};
	uint32_t N[32] = 				{0x4aeeb107, 0x5d78aa98, 0x6c55dd05, 0x6f5326c9, 0xf93f738c, 0xc10fa093, 0x20478120, 0x099d6d70, 0x833d9b82, 0x1248f3ed, 0xa43ed737, 0xc1c1da45, 0x9f23e5c7, 0xb17c3598, 0xe8938df6, 0x7ae59036, 0x9f84d87b, 0xc8710dc6, 0x249ee0f8, 0x46eeae2f, 0x66a3bb9b, 0xfeef4c6b, 0xc7b55eae, 0x7951dd0c, 0x0b4391e8, 0x141ad586, 0x1a568588, 0x908293dd, 0x472c0bea, 0x8d00abfe, 0xed17377f, 0x83a01efe};
	uint32_t n_prime[32] = 			{0xe7d41349, 0x0c828dcd, 0x2dc06d90, 0x318f87bf, 0x1992ba09, 0x4b1bef10, 0x011ba664, 0xe3a7d9cf, 0x44449fbd, 0x89714d34, 0x6cd49cc4, 0x49c5b99d, 0xf90435b1, 0x38f037b7, 0xba9720db, 0x9641b106, 0xbca01d2a, 0xfdb82893, 0xbd7ce9c7, 0x372823e1, 0x4901cdde, 0xaa28d457, 0xe9f78c94, 0xb6e1e5b3, 0x5a79f7a6, 0xf5212a83, 0x2b1aab45, 0xa3924b69, 0x3c63a8af, 0x12fa121d, 0x7500bea0, 0xe58878e7};
	uint32_t expected_output[32] = 	{0xeb7e3ef3, 0x40b90c4f, 0xd9c234b1, 0x2461cd34, 0x183481c7, 0x0bc4e5bd, 0x4803996e, 0x755d1777, 0x698f88c7, 0x2e78b03b, 0xa55cfb32, 0x74d1c12a, 0xc6bc8934, 0x581d4714, 0x7d504a58, 0xb29753f1, 0x99ae0c37, 0x65c4cc3a, 0x4153aacb, 0xe0a5c4bf, 0xce0a9c7c, 0x4babfb22, 0x75aa490d, 0x43b6ec25, 0xdcb17a10, 0x47deec3c, 0xd0e2735f, 0x16726b8e, 0x0f486246, 0x0f74d471, 0xe62a3577, 0x065a0397};

	#else /*MULT_TESTVECTOR*/
	// P_p -> t_p in combineResult with seed 2018
	uint32_t a[32] = {0x85830650, 0xf9786778, 0xb70f010d, 0xced5bf57, 0xdd735e9a, 0x56207c18, 0xd8094a41, 0xcd33b939, 0xe08c35a4, 0x1a1303e1, 0xd97a7a39, 0xfd6fe611, 0x47a435a3, 0x8aaaa241, 0x9a996ec9, 0x437ec29e};
	uint32_t b[32] = {0x43be7af1, 0xeafc80db, 0x54e9ee44, 0x158c2fe4, 0xe6ef1620, 0x088d3615, 0x188a0ca2, 0x8d8cdd1f, 0x06e202c9, 0x41d8a6f3, 0xa649a603, 0x7cfd8116, 0xc8c86d3f, 0x062bc5e5, 0x072e75fb, 0xa293659f, 0xf2ca2a61, 0x5c3a9f79, 0xf9142817, 0x6f3f84e4, 0xb02af2ae, 0xfa90b41d, 0x70c1143a, 0xb7da447e, 0xc836d610, 0x5e8425d3, 0x1e7b2c9a, 0x9243974d, 0xe080d1d7, 0xf9d17d39, 0xa6a021e1, 0x6720eba4};
	uint32_t N[32]   = {0x15eccfc1, 0xa5fd5f9e, 0x7f76eca4, 0xa9e435d8, 0xab84283c, 0x4f99fd31, 0x6ca75907, 0x4c0c84c9, 0xc0de16d2, 0x1f35c9b6, 0x83ccb378, 0x7f6f94cc, 0x66790995, 0xb7c94c58, 0xf5954def, 0x421c3722, 0xddbd7efe, 0xe35ab0bb, 0x7bcfedd6, 0x6992174a, 0xe00e6e5b, 0x386fd518, 0x3b6148c4, 0x6885c790, 0x568881ba, 0x98952f40, 0xcfc7065d, 0x34cd4190, 0x930b117c, 0x9413d84d, 0x5cbf9f35, 0xd5b65cae};
	uint32_t n_prime[32] = {0x4950bfbf, 0x26c67233, 0xb2ce12dd, 0x67a25752, 0x22e1761a, 0xe6f2b204, 0x25a0697e, 0xcd5914af, 0x3505ec06, 0xddda9741, 0x7aab37e0, 0x4620fa57, 0x7bef5837, 0x0dbb1fab, 0xe7f8a289, 0x6c9f80e6, 0xf7b033d4, 0xd2a6e9e4, 0xd0a9a82d, 0xb82a800c, 0xec137b79, 0xa75142c5, 0xefb5bf31, 0x02a80107, 0x6b4b2a79, 0x0baf9e5d, 0xe721c448, 0xba912d58, 0xf9e82077, 0x64c88a1c, 0x801041d3, 0x6cb7b698};
	uint32_t expected_output[32] = {0x5464e333, 0x44f8fe2b, 0xf83eecfe, 0xdfc33e69, 0x740c3e43, 0x6695b71e, 0x274097c8, 0x54880ddd, 0x56496d92, 0x606da4bf, 0x86662e38, 0x7a023e3c, 0x35f23153, 0x813409a4, 0xe2b91b54, 0x83863679, 0xfbc44c0e, 0xafe7d499, 0xefcb0f6e, 0x47fbbd56, 0x16fb41ad, 0x77821593, 0x7595f37f, 0xbac577d0, 0x8633b85d, 0x0af8b3d8, 0xfe363ab2, 0xe2dfc91c, 0xe8a56a7b, 0x69af670d, 0x0c5e8901, 0x0a1d976c};
	#endif /*MULT_TESTVECTOR*/

	// Code Jasper semester 2 from montgomery2.c
	mont_mult(a, b, N, n_prime, result, 32);

	// Code semester 1 from sw.c
	// montgomery_multiply(A16, B16, N16, N_prime16, result, 16);

	printMontResult(32);
	xil_printf("Expected ");
	printArray(expected_output, 32);

	if (memcmp(result, expected_output, 32) != 0) {
		xil_printf("Software montgomery mult failed\r\n");
		abort();
	}

	xil_printf("Test software montgomery mult succeeded\r\n");
}

void test_hw_mont_mult() {
	#define HW_MONT_MULT_TESTVECTOR 5

	#if HW_MONT_MULT_TESTVECTOR == 1
	uint32_t A16[16] = 				{0x51977946, 0x7957b1be, 0x9f030fbd, 0x04561a82, 0x1fad9525, 0xab8e0526, 0x05c0a4a8, 0x4dcc3907, 0xc8ae12c7, 0x8b7d54ca, 0x22e43d05, 0x806b8cac, 0x13cbfd6b, 0x36d3028f, 0x52132ef0, 0xc51931a9};
	uint32_t B16[16] = 				{0x5fc3d1ef, 0x96dec894, 0x2d5929f7, 0xc0810a9f, 0x8b55af12, 0x3548fef6, 0x3d61e914, 0xc5784013, 0x20669791, 0x154a73de, 0x98e985d3, 0xe3d56445, 0xcb4fba56, 0x5f0012cc, 0xca83b655, 0xb220f8c0};
	uint32_t N16[16] = 				{0x0ebd5f75, 0x948cb7ab, 0x58727656, 0x0f02d0b4, 0x6ed897f2, 0x052304af, 0xcea1ed9f, 0x2e3b3a4c, 0xaa19906f, 0x0a3be041, 0x6ae0754b, 0x28470c40, 0xc871a4de, 0x10943525, 0x105d393e, 0xc6bb131b};
	uint32_t expected_output[16] = 	{0x9e31ea81, 0xe265cbb7, 0x5e453a5a, 0xffe854d5, 0x58b4d35b, 0x5370eae7, 0xfd0d421a, 0x66dd18b8, 0x7b232ec6, 0xb6df247f, 0x3f359f29, 0x4c244688, 0xc901b64c, 0xda554d8d, 0x7e49f069, 0x9712a929};

	#elif HW_MONT_MULT_TESTVECTOR == 2
	uint32_t A16[16] = 				{0xbaf3f13d, 0x3d48382a, 0xf0dae4f3, 0x9d8bf767, 0xc95550e2, 0xb365a6ca, 0x03020227, 0xeab17e8f, 0xee315b4e, 0xb3f8de91, 0x06d4fe65, 0x5fbc9aae, 0x8bd7b2a7, 0xdc1cecdb, 0xa5fe5cb6, 0x087bd031};
	uint32_t B16[16] = 				{0x2b406a1f, 0xcfb1b4be, 0x6c0e64b2, 0x38e5d252, 0xa9f6e1d3, 0x1d5f918e, 0x756b5fea, 0xfc70a562, 0xa2e27c64, 0x4869a6ea, 0x143850a9, 0x4ddf8edb, 0xfe6bed6c, 0x853b4af0, 0x258466ec, 0x03028f0f};
	uint32_t N16[16] = 				{0x0fbe29d3, 0x7a6e2ad9, 0x20b9da4b, 0xe3ab7787, 0x63559705, 0x0548c948, 0x5c5083d7, 0xc567882a, 0xa1c1a53d, 0x5ea047b9, 0xf674df8f, 0xc9a5235c, 0x1c44ba80, 0x20bc0ad8, 0x3d770d40, 0xf47bc3b5};
	uint32_t expected_output[16] =  {0x5c99333f, 0xb8b8219c, 0x974e2f8e, 0x577230ac, 0xf3df736e, 0x99f734c8, 0x94933ce5, 0x6b207105, 0x80ff4f40, 0x0f93708f, 0xa09de9ef, 0xa6c39779, 0xb4fea621, 0x57069fec, 0x8a5628f4, 0x7fa6e824};

	#elif HW_MONT_MULT_TESTVECTOR == 3
	uint32_t A16[16] = 				{0x394bb869, 0x0ac85ad8, 0x2e0ae82e, 0x35380963, 0xa6734271, 0x66a29154, 0xb5f0eb8c, 0xf75e26b4, 0x6dd116da, 0x965705bf, 0x85ee3e98, 0xcf3c9f9a, 0x289bc924, 0x3d23d751, 0x77a26eee, 0xae8a1514};
	uint32_t B16[16] = 				{0x521da139, 0x184b0dad, 0xd153e4f3, 0x56032052, 0xcb8d25a4, 0x8acbeab9, 0x7d07f88c, 0xaadcaea1, 0x0fa09f2e, 0x7b230769, 0x65750b15, 0x1715b574, 0xc7c5b2df, 0xb9718bea, 0x7f3da325, 0x96952c75};
	uint32_t N16[16] = 				{0x3a5a2fe1, 0x06282557, 0xdd8a0cf7, 0xe9f5a682, 0x4d6b648a, 0x78fb7a78, 0x749fe9d8, 0x40855018, 0xb459a4a2, 0x5ebe1521, 0xb80efcda, 0xc86622f7, 0x9a083ca2, 0x28cfadda, 0x369d9902, 0xafd40356};
	uint32_t expected_output[16] =  {0x965eae17, 0xb4316f86, 0xc020d2e8, 0xbb265a05, 0xb0f1d1dc, 0xf5434089, 0x1ba9a7ef, 0xc12627f1, 0xfeeb7ed4, 0xdcde67cf, 0x13583024, 0x6d895c9f, 0x8cccf3bf, 0xad1020f2, 0x7bc22ac2, 0x600d3758};

	#elif HW_MONT_MULT_TESTVECTOR == 4
	uint32_t A16[16] = 				{0x5f3e75e6, 0xc08fa6c3, 0x643473d1, 0x1eff0f99, 0x39483aee, 0xb680ad01, 0x6d393c9a, 0xd684cb28, 0x5e89931d, 0x40cc32dc, 0xd9f90da9, 0x2217fb3a, 0x5ab7eebd, 0xedf9cd68, 0xd6dec48d, 0x3ccbb89e};
	uint32_t B16[16] = 				{0x2ef60fd0, 0xc5ee76dc, 0xbf02bafa, 0x0750058d, 0x2ef0bf03, 0x041f5a19, 0x0602feea, 0xd53bf718, 0x53983960, 0x034b0262, 0x3a212201, 0x1cae2854, 0x4dd916b4, 0x29755811, 0xf9257b18, 0x3ba8ea30};
	uint32_t N16[16] = 				{0xad534215, 0x79edc1b4, 0x8f1e3221, 0x5acae35e, 0x9ab95cc4, 0x193f63d2, 0x025b8522, 0x098ae441, 0x9381690d, 0x5a6d61a8, 0xa3b05b56, 0x08d00149, 0x874f15f3, 0x972a08ec, 0x6328529f, 0xa58cc33e};
	uint32_t expected_output[16] = 	{0xf5a6cd97, 0xf8963f1a, 0x664a2281, 0x2b748cfd, 0x18d433d0, 0xb36528fa, 0x585b3d53, 0x03dcf1ee, 0xeb636354, 0xa2c8fd98, 0x73c19b5e, 0x67a1446b, 0xf89bfb05, 0xdff54a43, 0xc9ab43c6, 0x1d2662ce};

	#elif HW_MONT_MULT_TESTVECTOR == 5
	// multiplication in reduction p with seed 2017.5
	uint32_t A16[16] = {0x69b231e5, 0xedcf485b, 0x7296a3a5, 0x18e7359e, 0xdb6ee0fe, 0xf44a328e, 0x6ed95807, 0x13f8e5fe, 0xaacf2980, 0x5da1b6b3, 0xf909711a, 0x752c6f44, 0x055d877d, 0x71898cee, 0x2b81d3e0, 0x29612ac0};
	uint32_t B16[16] = {0xaef0309e, 0x835b1c26, 0x7c8c7c98, 0x5bd1261d, 0xba15e4d9, 0xe9e5286e, 0x3d7700f6, 0xc89b0109, 0xb2489412, 0x68095cd1, 0x23c27478, 0x4ee0f592, 0x980b80e8, 0xd42d7d6f, 0xa80a8645, 0x268171a0};
	uint32_t N16[16] = {0xb4d8c50d, 0xab2d4239, 0xcc52c6bd, 0xbcfc0dc9, 0x06e74d5b, 0x51c9419e, 0x2b625fbe, 0x27752c42, 0xa2e6ed3d, 0x466e8aa1, 0xd6cd644d, 0xc8b75f23, 0xcbb78fe1, 0x5fe14b0c, 0x838da10f, 0x884fb732};
	uint32_t expected_output[16] = {0x24edc7cb, 0x5f7b06f3, 0xf95a4326, 0x146275dc, 0x37d3967d, 0x0fdac629, 0x69f9296f, 0xbf7b3444, 0x9b4e069b, 0xb3b2dbe4, 0x453de278, 0x9ec53891, 0x6889ffc8, 0xed432111, 0xd4912772, 0x60f4e9a4};

	#else // HW_MONT_MULT_TESTVECTOR
	uint32_t A16[16] =			 	{0xe99c0d36, 0xf9c07fe3, 0xcc848d93, 0x0995e07a, 0xb0fd3fa7, 0xe8a63fff, 0x65f0c2fc, 0x7786425f, 0xa53b20f0, 0x6ac46232, 0xf0acb0d0, 0x0b1ff924, 0x1285dd24, 0xc9022bad, 0x27cc58be, 0x8e999818};
	uint32_t B16[16] = 				{0x33ffe466, 0xa7cce3ca, 0xcdeba809, 0x8b28a43a, 0x8585f217, 0xef68d195, 0xa26b94ef, 0x38fb80ff, 0xb944284d, 0x639149e8, 0xd5da2b1a, 0x91d6c518, 0x2c51e12a, 0xb3e733d3, 0xb106897b, 0x3e1fc5f4};
	uint32_t N16[16] = 				{0xa51a5baf, 0x947ab35c, 0xaed3b9a8, 0x3aebb0f7, 0x247ff270, 0xf8f5314a, 0x1220cd68, 0x26f54d7b, 0xa151284d, 0xfc80b8e2, 0x53f8d7e4, 0x8a239ec4, 0xe79e52ca, 0x2c660ebc, 0xf75c4534, 0x92c96dcd};
	uint32_t expected_output[16] =  {0x597ef324, 0xe96cb8ec, 0x1ac62a8e, 0x85c59cd4, 0x498d19ad, 0x16017e18, 0x7dca7d36, 0x3db0199a, 0xa5f3c3cb, 0x3082e129, 0x6152e22c, 0x9965143d, 0xe51aa7ed, 0x79851fe0, 0xa63a4a1d, 0x54dd8102};

	#endif

	hw_montgomery_multiply_first((unsigned int*) A16, (unsigned int*) B16, (unsigned int*) N16, (unsigned int*) result, 16);
	printMontResult(16);
	xil_printf("Expected: \r\n");
	printArray(expected_output, 16);

	if (memcmp(result, expected_output, 16) != 0) {
		xil_printf("Hardware montgomery mult failed\r\n");
		abort();
	}

	xil_printf("Test hardware montgomery mult succeeded\r\n");
}

void test_hw_mont_exp() {

#define HW_EXP_TESTVECTOR 11

	#if HW_EXP_TESTVECTOR == 1
	uint32_t X[16] = {0xe1e4acac, 0xcfa2f28e, 0x79abcdd4, 0x7d90773f, 0xa844ad2f, 0xe93b3a0e, 0xf321f2da, 0x1b80c645, 0x365232bd, 0xd77af168, 0xe805b057, 0xf5e2e949, 0x472d5f9c, 0x9a5824e5, 0xffc0b738, 0x1c836853};
	uint32_t E[16] = {0x00000086, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000};
	uint32_t M[16] = {0x47bb976d, 0x8d903197, 0x46d46d3e, 0xf2af5e42, 0xdbe25735, 0x9c1b31c1, 0x824258be, 0x0264007a, 0xf69d061d, 0x6d5187cc, 0xea0a2663, 0x355adcd9, 0xd2b070b2, 0x044ed0f3, 0x2cc56478, 0xb3688c5d};
	uint32_t R[16] = {0xb8446893, 0x726fce68, 0xb92b92c1, 0x0d50a1bd, 0x241da8ca, 0x63e4ce3e, 0x7dbda741, 0xfd9bff85, 0x0962f9e2, 0x92ae7833, 0x15f5d99c, 0xcaa52326, 0x2d4f8f4d, 0xfbb12f0c, 0xd33a9b87, 0x4c9773a2};
	uint32_t R2[16] = {0xf65d5f54, 0x97c58cc0, 0x9cd341b9, 0x6f129ecf, 0xb3486c19, 0xb85b40e5, 0x3c285856, 0x2ea132a1, 0x17557caa, 0x31024d20, 0xc90fda79, 0x9d15b89e, 0xcb302a4a, 0xc6bfd730, 0x4ef91762, 0x165bf141};
	uint32_t exp_len =  8;
	uint32_t expected_output[16] = {0x73138981, 0x9dcee2dd, 0xcc05a3a9, 0x9d66ae39, 0x244186b5, 0xd0af1219, 0xcd7e4c08, 0x6d4cc1ce, 0x17a20e1b, 0x2bd8dde2, 0x099a7a3a, 0xc405fe12, 0x1f9b8f85, 0x5faed2c7, 0xf23948c3, 0xab96e8e6};

	#elif HW_EXP_TESTVECTOR == 2
	uint32_t X[16] = {0x19baf1db, 0xab1df557, 0x84f70321, 0x25528107, 0xdf762f5c, 0xa6a219b4, 0xa1c61436, 0x76deb3ee, 0x512a5b82, 0x861314e2, 0xe04efd26, 0x64f9b2b3, 0x9cdf8237, 0xfeb9d27c, 0x6789027a, 0x400906d0};
	uint32_t E[16] = {0x000000be, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000};
	uint32_t M[16] = {0xbd52ecd9, 0x4ea51471, 0x5fb4cb12, 0x589a7e6b, 0x849a36c0, 0x7956cf6d, 0x81e062cd, 0x7c729fe0, 0x105137ad, 0x2a116d36, 0x0fe06dfa, 0x47f9ab0b, 0x0efc4e34, 0x00784f23, 0x44681140, 0xae7f63fc};
	uint32_t R[16] = {0x42ad1327, 0xb15aeb8e, 0xa04b34ed, 0xa7658194, 0x7b65c93f, 0x86a93092, 0x7e1f9d32, 0x838d601f, 0xefaec852, 0xd5ee92c9, 0xf01f9205, 0xb80654f4, 0xf103b1cb, 0xff87b0dc, 0xbb97eebf, 0x51809c03};
	uint32_t R2[16] = {0xf73e090b, 0x6cbb908f, 0x398461df, 0xf1d661c9, 0x9752d52b, 0xfb52b0e7, 0xe0ac768a, 0x65d7fb84, 0x812fa6c1, 0x7ea5ca89, 0x5b73e9a0, 0x4a8bfcdb, 0xb76bd22f, 0x7bb9e01c, 0x39de4815, 0x2015554e};
	uint32_t exp_len =  8 ;
	uint32_t expected_output[16] = {0x8b19fcb1, 0xf8963597, 0xbaa14924, 0x88729ab1, 0xb7b641e2, 0x0c1afbed, 0x4ce9a43f, 0x9eeea426, 0x93afbadb, 0x12f8336d, 0xadc22912, 0x008007da, 0xf40cbdbd, 0xcbac3791, 0xf43004cb, 0x25f9be3e};

	#elif HW_EXP_TESTVECTOR == 3
	uint32_t X[16] = {0x38c7a291, 0x1cddcff4, 0xd83c12e2, 0x9944fc26, 0xd8a6004e, 0x1b25cc27, 0xbadc1f5c, 0xf1bf89aa, 0x25f16e60, 0xaec302d9, 0x85e15888, 0x0691905b, 0x7d0f1fb8, 0x02efffd6, 0xbf19cd8f, 0x13807b38};
	uint32_t E[16] = {0x000000f1, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000};
	uint32_t M[16] = {0xefac194b, 0x96f8ab47, 0xdeef1734, 0xd9400975, 0xb9ac336b, 0x77ba2134, 0xdcba2e69, 0x9cbc0e37, 0xab7b2a4f, 0x8849e452, 0x13c41ae9, 0x92e349b0, 0x22adaa0f, 0x51b4e60b, 0x710fd4ae, 0xb871d147};
	uint32_t R[16] = {0x1053e6b5, 0x690754b8, 0x2110e8cb, 0x26bff68a, 0x4653cc94, 0x8845decb, 0x2345d196, 0x6343f1c8, 0x5484d5b0, 0x77b61bad, 0xec3be516, 0x6d1cb64f, 0xdd5255f0, 0xae4b19f4, 0x8ef02b51, 0x478e2eb8};
	uint32_t R2[16] = {0x150bb4b8, 0xafdb2501, 0xe0ffdc08, 0xdeaaee87, 0x326ce83b, 0x5bea1695, 0xddd7c184, 0xe83b578d, 0xf955caaf, 0xa276976c, 0x2ae67c60, 0x557243b5, 0x074247dc, 0xfc09e6fd, 0xe8cedcac, 0x936d9bcc};
	uint32_t exp_len =  8 ;
	uint32_t expected_output[16] = {0x996cf0e4, 0x778f0bc7, 0x9ec4f151, 0xaa4cb748, 0xbf3fe33b, 0x36a60576, 0xff3fcdfd, 0x53320af0, 0x5ca9b1c8, 0xee6f465f, 0xd1232236, 0x90b9976c, 0xc09fb0bf, 0xc4ef14ec, 0x46a91b4a, 0xaa6785b7};

	#elif HW_EXP_TESTVECTOR == 4
	uint32_t X[16] = {0xe41b46f8, 0x5eac3cd6, 0x4cfb4c35, 0xca1c16e1, 0xbabf8b81, 0x9850361e, 0x8ab3ee77, 0xa436d0fc, 0xddf59c22, 0x2b105139, 0xa6b8b049, 0x4d994585, 0x6a15c194, 0xb7f47709, 0x3045bcba, 0x25aeb0be};
	uint32_t E[16] = {0x0000008f, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000};
	uint32_t M[16] = {0x655b79a5, 0x046fc3af, 0x9420c08d, 0xc35000af, 0x8ead25ae, 0xc5cd0636, 0xe08e8018, 0x026e549b, 0x3c3abe85, 0x69c3c37e, 0x5c5377bf, 0x0ff586a5, 0x0e999696, 0xaaa02921, 0xcf496395, 0xcea8f2df};
	uint32_t R[16] = {0x9aa4865b, 0xfb903c50, 0x6bdf3f72, 0x3cafff50, 0x7152da51, 0x3a32f9c9, 0x1f717fe7, 0xfd91ab64, 0xc3c5417a, 0x963c3c81, 0xa3ac8840, 0xf00a795a, 0xf1666969, 0x555fd6de, 0x30b69c6a, 0x31570d20};
	uint32_t R2[16] = {0x95e32475, 0x18db999f, 0x95f949bb, 0x026d2e38, 0xff130041, 0xc648c72b, 0x559803ec, 0xef6bc9b9, 0x56d94d13, 0xb3d500c9, 0x20cc74af, 0x63c6463f, 0x5c7ae361, 0x00681afa, 0xe48e80fa, 0xa173401b};
	uint32_t exp_len =  8 ;
	uint32_t expected_output[16] = {0x99feca9a, 0x6d38fc47, 0x25354ead, 0x56a982a0, 0x43e8fd9f, 0xe6a4e496, 0x6d045926, 0x4157823d, 0x60500b7a, 0xda96be9d, 0x18b3b393, 0xb195b981, 0x97cc79a8, 0x268cc158, 0x202742f0, 0x7cd5563e};

	#elif HW_EXP_TESTVECTOR == 5
	uint32_t X[16] = {0xc51ab3a7, 0x7f023f62, 0xd78f5f02, 0xccf2d5ad, 0xe2f23e58, 0x9294dd4d, 0x83dcad99, 0x3c5f336c, 0xcf329314, 0xe11391f4, 0x041d35c7, 0x8593fcd5, 0xd38cc38f, 0x5979cc7c, 0xcc5911bf, 0x4548aa4a};
	uint32_t E[16] = {0x000000c3, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000};
	uint32_t M[16] = {0x5f985af5, 0xd180d91a, 0xbe553ae2, 0x2029eec8, 0x60412c1f, 0xb46ff7c0, 0x7fb1d3a7, 0x9b4b4a64, 0xa263af07, 0xdfafee9f, 0x25778da3, 0xcee60e08, 0x2ed19506, 0x43d35b3a, 0x68eba94e, 0x8af2402a};
	uint32_t R[16] = {0xa067a50b, 0x2e7f26e5, 0x41aac51d, 0xdfd61137, 0x9fbed3e0, 0x4b90083f, 0x804e2c58, 0x64b4b59b, 0x5d9c50f8, 0x20501160, 0xda88725c, 0x3119f1f7, 0xd12e6af9, 0xbc2ca4c5, 0x971456b1, 0x750dbfd5};
	uint32_t R2[16] = {0x4fc27f25, 0x50dfb80f, 0xbe4b2d61, 0x33c1a942, 0xb3dd8ea5, 0xb959bbf0, 0xeb098a45, 0x60198ccf, 0xd813f80b, 0xa1e76957, 0xff99aefa, 0x20241d42, 0x218ae452, 0x9ca0d7fe, 0x9b71d1e0, 0x6f3f4832};
	uint32_t exp_len =  8 ;
	uint32_t expected_output[16] = {0xb3d65a39, 0x63f11253, 0x3efffa5e, 0x826b0f09, 0x4353e435, 0x6575f19e, 0x7e3b8b26, 0x75922676, 0x98e34a79, 0x106b2859, 0x4ccff0b9, 0x70aa5865, 0x674a0a49, 0x9f0cd794, 0xf4602779, 0x3f1991c2};

	#elif HW_EXP_TESTVECTOR == 6
	uint32_t X[16] = {0x1730e2b1, 0x301acab7, 0xa31589a6, 0xd8a762f5, 0xd3943618, 0x3deef885, 0x3928178c, 0xbff73306, 0x1259cc8a, 0x856b9533, 0x0c960f44, 0xf5154aee, 0x340830e1, 0x602e80dc, 0x6612c8b4, 0xe55d2ec0};
	uint32_t E[16] = {0x000000f1, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000};
	uint32_t M[16] = {0x9e9bcc1f, 0x5ef191d4, 0x9573d9cb, 0x43692a44, 0x17bbad06, 0xa013ae09, 0xc9d1a336, 0x51960f8e, 0x42983cb3, 0x7a0abb08, 0x72b50945, 0xc0e090c6, 0xb4392f25, 0x0beb4f10, 0xd3a097cf, 0xe7451ad2};
	uint32_t R[16] = {0x616433e1, 0xa10e6e2b, 0x6a8c2634, 0xbc96d5bb, 0xe84452f9, 0x5fec51f6, 0x362e5cc9, 0xae69f071, 0xbd67c34c, 0x85f544f7, 0x8d4af6ba, 0x3f1f6f39, 0x4bc6d0da, 0xf414b0ef, 0x2c5f6830, 0x18bae52d};
	uint32_t R2[16] = {0xf47cfdd7, 0x8879d068, 0x28c80244, 0x41bf19ef, 0x7a888c9e, 0x527aa265, 0x6d176fdf, 0x22fb0d72, 0x6e70b0e5, 0xede2fd1b, 0x1eaad76e, 0xcdb68ea5, 0xe0a7c4cd, 0x534907a3, 0x73a322f9, 0xc5f89a2a};
	uint32_t exp_len =  8 ;
	uint32_t expected_output[16] = {0xd75cb3d8, 0xc15f1b7c, 0xf0bdac4e, 0xd5593cf8, 0x69a97e62, 0x8f8a832e, 0x403698f0, 0x7b1cb5fd, 0x77222324, 0xd6b5dcb2, 0x39ca3923, 0x60aa2186, 0x1d68f5e7, 0x1bde83b2, 0xa536fe97, 0xa13865f6};

	#elif HW_EXP_TESTVECTOR == 7
	uint32_t X[16] = {0x4d6918f6, 0x6f62a081, 0x033fb7bc, 0x716a4c1e, 0xf97b264b, 0x7a701428, 0x4c3008f0, 0x71c5191e, 0xb57103d9, 0xd8127e26, 0x92fff815, 0x11a83b9a, 0x3466fe52, 0x69ef7dc0, 0x898a99b9, 0x548a6e4a};
	uint32_t E[16] = {0x0000a27f, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000};
	uint32_t M[16] = {0xea38c733, 0xa45505ba, 0x2a2cac18, 0x5bf8a510, 0xa54d6bdf, 0x0a10723a, 0xf0215f67, 0xb7d23c4a, 0x049307aa, 0x1dcd4f45, 0xc0ccb529, 0x2cd8d458, 0xa0fb747b, 0xbc5888f9, 0x52d4c504, 0xa2b93cda};
	uint32_t R[16] = {0x15c738cd, 0x5baafa45, 0xd5d353e7, 0xa4075aef, 0x5ab29420, 0xf5ef8dc5, 0x0fdea098, 0x482dc3b5, 0xfb6cf855, 0xe232b0ba, 0x3f334ad6, 0xd3272ba7, 0x5f048b84, 0x43a77706, 0xad2b3afb, 0x5d46c325};
	uint32_t R2[16] = {0xb766ffb6, 0x0f9b31ca, 0x190f8d40, 0x7ab304e0, 0x3831652c, 0x46e3cc74, 0x993b0166, 0x09d3a8de, 0xc09be231, 0x9d83ad7b, 0x7589c766, 0xcd5cfef0, 0xd1c4e570, 0x61868d7a, 0xb9c9a62e, 0xa24a85a7};
	uint32_t exp_len =  16 ;
	uint32_t expected_output[16] = {0xa390f7c5, 0x4653f79e, 0xe9d43bad, 0x5f5a5791, 0xedb5b4c1, 0x7812a7fd, 0xed76bc12, 0xd0b27dbc, 0x7fde3aa4, 0x3988a154, 0xe3d2febf, 0xaff0d295, 0x3a0b9377, 0x26324967, 0x308f7a6f, 0x65a06fd0};

	#elif HW_EXP_TESTVECTOR == 8
	uint32_t X[16] = {0x847e6560, 0x95183c51, 0xf7c8cf51, 0xc9919938, 0x4fe6dbad, 0x77fd7707, 0xff2e7029, 0x1db3b091, 0x35e72d2d, 0xea1ad907, 0x8c38c099, 0x5ce773dc, 0x0d3462c2, 0xca55566e, 0x606c5c90, 0x4010a535};
	uint32_t E[16] = {0x0000e965, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000};
	uint32_t M[16] = {0x7ac079d5, 0x103238ec, 0x2067d4a1, 0x660ccd71, 0xd5db742f, 0x25a0b11a, 0x893ef8a7, 0xdce3f43a, 0xe2c4600d, 0x4a61ab38, 0x85e2c4f1, 0x6ac2fc79, 0x13288606, 0x89d19a4a, 0x2d9197bf, 0xb9fe13f2};
	uint32_t R[16] = {0x853f862b, 0xefcdc713, 0xdf982b5e, 0x99f3328e, 0x2a248bd0, 0xda5f4ee5, 0x76c10758, 0x231c0bc5, 0x1d3b9ff2, 0xb59e54c7, 0x7a1d3b0e, 0x953d0386, 0xecd779f9, 0x762e65b5, 0xd26e6840, 0x4601ec0d};
	uint32_t R2[16] = {0x12c0582f, 0x99fa8ea3, 0x76ef62e2, 0xfb4e23d4, 0xab619b14, 0x996abccc, 0xacbf62e2, 0xebf657cb, 0xb68973a3, 0x606fff6d, 0x20712204, 0x4c78dbd7, 0x09f54ef6, 0x8e33106e, 0x4fe1d558, 0x5c5831d6};
	uint32_t exp_len =  16 ;
	uint32_t expected_output[16] = {0xbe44602b, 0x6694a400, 0x9a9ee1e7, 0xb2c25a11, 0x6a95040f, 0x17f10862, 0x976270e6, 0x44d587cc, 0xf7c016f8, 0x055f0e77, 0x8c5d1879, 0x0df48dda, 0xcd6074e1, 0xd9be0069, 0x40967772, 0x1005d164};

	#elif HW_EXP_TESTVECTOR == 9
	uint32_t X[16] = {0xbaa7b04e, 0x77e202ed, 0xee96badd, 0x8c4b547e, 0xc4645ab0, 0x9a557534, 0xa9964e76, 0xad82f220, 0x84767f0b, 0x66a18e3f, 0xa296ca2e, 0x4f33b93f, 0x55df3e47, 0xbcde17b9, 0xcd23a6fc, 0x96f07337};
	uint32_t E[16] = {0x000096b8, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000};
	uint32_t M[16] = {0x88a87b27, 0x38f205fb, 0x8774ee9e, 0xeb861f8e, 0xfb57fffe, 0x8e1c055b, 0x4d07480a, 0x271702b7, 0x0299ffac, 0x946b2fa3, 0x8a868515, 0xf27b056e, 0xdbef15d1, 0x93e2a5b0, 0x71667018, 0xe4d7d1f9};
	uint32_t R[16] = {0x775784d9, 0xc70dfa04, 0x788b1161, 0x1479e071, 0x04a80001, 0x71e3faa4, 0xb2f8b7f5, 0xd8e8fd48, 0xfd660053, 0x6b94d05c, 0x75797aea, 0x0d84fa91, 0x2410ea2e, 0x6c1d5a4f, 0x8e998fe7, 0x1b282e06};
	uint32_t R2[16] = {0x8d1e0c61, 0x5567c870, 0x00c30d36, 0xc0bbca48, 0xb11f9aee, 0x43ce4751, 0x97857249, 0x6a6472ac, 0x6e9dd9f4, 0xef01b43c, 0x230677ab, 0xa6d19949, 0xbc4463f9, 0x4140264d, 0x37976d67, 0x47882e26};
	uint32_t exp_len =  16 ;
	uint32_t expected_output[16] = {0x021cf9e2, 0xc0d949c8, 0xb08a2889, 0x9157e7b3, 0xfd067566, 0x139fecc6, 0x650526f1, 0x90edf022, 0x2f6d0cb5, 0x6b37e520, 0xe88cc3a5, 0x06724fc0, 0x0afe4edb, 0x5c33fe96, 0x000270c2, 0x260bd025};

	#elif HW_EXP_TESTVECTOR == 10
	uint32_t X[16] = {0x666d813b, 0xfe437f4a, 0xbed77c15, 0x6163e145, 0xbcf2b616, 0x38e25d91, 0x3343afce, 0xb2c75e87, 0x49ca4000, 0xf1fe90e7, 0x76d69036, 0x03bbe01f, 0x0a2d41c0, 0x1daf09a2, 0xab718c4d, 0xd3f52aea};
	uint32_t E[16] = {0x0000077e, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000};
	uint32_t M[16] = {0x9a68a339, 0x702a5866, 0x63d99455, 0xe030e37c, 0x300e67b9, 0xfe354d07, 0x82f0597b, 0x7d2e20fe, 0xe1b54212, 0x65e08a38, 0x0a817a11, 0x8e8b3cd9, 0xaf8e6678, 0x2c2f7ca5, 0x164a7c7d, 0xeefd02cc};
	uint32_t R[16] = {0x65975cc7, 0x8fd5a799, 0x9c266baa, 0x1fcf1c83, 0xcff19846, 0x01cab2f8, 0x7d0fa684, 0x82d1df01, 0x1e4abded, 0x9a1f75c7, 0xf57e85ee, 0x7174c326, 0x50719987, 0xd3d0835a, 0xe9b58382, 0x1102fd33};
	uint32_t R2[16] = {0xedf8cdc5, 0xc0144ecc, 0x62b58924, 0xbc94a22a, 0x441f706f, 0x1d0f0ffd, 0x65559aaa, 0x77fec414, 0xe5f8c51a, 0x97ed0351, 0x45265723, 0xd9b0d8a6, 0xe0960e0c, 0xa78b4d39, 0x69c59f73, 0x11921261};
	uint32_t exp_len =  11 ;
	uint32_t expected_output[16] = {0x80939129, 0x939bdf24, 0x98d3f650, 0xb61c2bf8, 0xf5ccff0f, 0x8ae8ea17, 0xbc702696, 0xa55f27ac, 0x7c574ae9, 0x4f3869af, 0xc696ba81, 0x515f15ab, 0x9b7a51d6, 0x4acec7fb, 0x3efc8eae, 0x996e8214};

	#elif HW_EXP_TESTVECTOR == 11
	uint32_t X[16] = {0x641530cd, 0xf245ac98, 0x4e953160, 0xa381873a, 0xd848de55, 0xbe7f687d, 0xfdc54bda, 0x6178805b, 0x11e5e593, 0x53728032, 0xf1b53ae6, 0xe4178546, 0x63a19b42, 0x36e07639, 0xeb9eee47, 0xcd6e8e63};
	uint32_t E[16] = {0x00000018, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000};
	uint32_t M[16] = {0x230753eb, 0x5114b09f, 0x2a94e34c, 0xd5caf7de, 0x58ddf9d9, 0xd0fa92fa, 0x9fa80fca, 0x6fc0b53a, 0x7ce8e4e2, 0x01c30016, 0x01f9284b, 0xcd217cee, 0x92bdb039, 0x84ae95a4, 0xa7e4a014, 0xf4fdc21c};
	uint32_t R[16] = {0xdcf8ac15, 0xaeeb4f60, 0xd56b1cb3, 0x2a350821, 0xa7220626, 0x2f056d05, 0x6057f035, 0x903f4ac5, 0x83171b1d, 0xfe3cffe9, 0xfe06d7b4, 0x32de8311, 0x6d424fc6, 0x7b516a5b, 0x581b5feb, 0x0b023de3};
	uint32_t R2[16] = {0x82423ce4, 0xbaa77daf, 0x16e31f43, 0x288d34d0, 0xd3a882a3, 0x511de3f1, 0x182c9407, 0x03bd6043, 0xe31ae9d3, 0x91297e9f, 0xd081863e, 0x3497ff4d, 0xae647b4c, 0x7b036027, 0x72d9b09e, 0x05e185a5};
	uint32_t exp_len =  5 ;
	uint32_t expected_output[16] = {0xcc3962b9, 0x142e76bf, 0x7bdbc534, 0xc5652548, 0x24951d1f, 0xffdb1e59, 0xd109daa4, 0x9d0efd84, 0x7fe38a8c, 0x9b90a011, 0x7107d204, 0x6769244d, 0x1e759f12, 0x974483a9, 0x20ca9a48, 0xb5129620};

	#elif HW_EXP_TESTVECTOR == 12
	uint32_t X[16] = {0x21643994, 0x2b411027, 0xf400ac9f, 0xa09159a2, 0x348e0701, 0x4dc37053, 0x04657cb8, 0xdc826df3, 0xb8744b80, 0xd49fe27f, 0x6912dc14, 0xf33e7bb7, 0xf17297c2, 0xe30135c1, 0x4e475748, 0x6ef334ba};
	uint32_t E[16] = {0xf359c5e0, 0x64eefbf8, 0x00951c99, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000};
	uint32_t M[16] = {0x0e945f75, 0x1786ecfb, 0x3926fd3a, 0x8abd8e75, 0x8f70ee16, 0xa55ccb9d, 0x48e7f010, 0xeb966ebb, 0x0a75c0ed, 0xee15bc27, 0xedabd8e7, 0xb5625abd, 0x5da6e742, 0xe0eb56ca, 0x7ca85220, 0x83c2c235};
	uint32_t R[16] = {0xf16ba08b, 0xe8791304, 0xc6d902c5, 0x7542718a, 0x708f11e9, 0x5aa33462, 0xb7180fef, 0x14699144, 0xf58a3f12, 0x11ea43d8, 0x12542718, 0x4a9da542, 0xa25918bd, 0x1f14a935, 0x8357addf, 0x7c3d3dca};
	uint32_t R2[16] = {0xc552b7bd, 0x6295b134, 0x869b3aab, 0xe037b1a0, 0xeae1a8a6, 0x778e7bfd, 0x49bef260, 0xf9966bed, 0xff2bce2b, 0x24f61a61, 0x8db62198, 0x66125460, 0x1cf3ad14, 0x35569050, 0xd7c15c0e, 0x33a44901};
	uint32_t exp_len =  88 ;
	uint32_t expected_output[16] = {0x2f29b43f, 0x63d5b4de, 0x860ae41b, 0x79ffe182, 0x76b14589, 0xd0751146, 0x64335025, 0x67a89179, 0x63c09871, 0x818d42c4, 0x1cad1992, 0xab47cb77, 0xb0e5c827, 0x74b00913, 0xd064a6de, 0x15f1501c};

	#elif HW_EXP_TESTVECTOR == 13
	// mod exp p of crtrsa seed 2018
	uint32_t X[16] = {0x1407db4c, 0x697e08d8, 0x482f3cde, 0x463cba2f, 0x2f1b0c8f, 0xcf9aac05, 0x1a629184, 0xf4d5f5a8, 0x43aa9de0, 0xd598bc40, 0x71cf280f, 0x209809a0, 0xf4152745, 0xa0b1db2b, 0xeccceed4, 0xa76afec9};
	uint32_t E[16] = {0xc86ae9c1, 0xc819a7b9, 0xeb5452f0, 0x88da8608, 0xa267e179, 0x119a4f9d, 0xffe059e1, 0xe50772ee, 0xeae5e3b7, 0x6526c36e, 0xbec6c866, 0x96eb1986, 0xe855765d, 0x08e04dcd, 0xfbe947c8, 0xb6fb4430};
	uint32_t M[16] = {0xbca0b1cb, 0x24d86196, 0x4136e0ea, 0xa7fbcaea, 0xeb996da1, 0x4a5cedab, 0x9255ee91, 0x38dd9dd6, 0xa3107e68, 0x47e04312, 0x315f02ef, 0xa45e7b6e, 0x7e7c9d58, 0x643db508, 0xe31b678a, 0xfe461672};
	uint32_t R[16] = {0x435f4e35, 0xdb279e69, 0xbec91f15, 0x58043515, 0x1466925e, 0xb5a31254, 0x6daa116e, 0xc7226229, 0x5cef8197, 0xb81fbced, 0xcea0fd10, 0x5ba18491, 0x818362a7, 0x9bc24af7, 0x1ce49875, 0x01b9e98d};
	uint32_t R2[16] = {0x28734ef9, 0x01b7bd78, 0xc885cd0b, 0xc479be8c, 0xcc61678c, 0x7c3fa2e8, 0x96c8b393, 0x832832b9, 0x088a2eba, 0x87e2a89e, 0x029bc403, 0x29aba830, 0xbac7c0bd, 0x6554ed76, 0xccc74159, 0x149a089a};
	uint32_t exp_len =  512;
	uint32_t expected_output[16] = {0x85830650, 0xf9786778, 0xb70f010d, 0xced5bf57, 0xdd735e9a, 0x56207c18, 0xd8094a41, 0xcd33b939, 0xe08c35a4, 0x1a1303e1, 0xd97a7a39, 0xfd6fe611, 0x47a435a3, 0x8aaaa241, 0x9a996ec9, 0x437ec29e};

	#elif HW_EXP_TESTVECTOR == 14
	// mod exp q of crtrsa seed 2018
	uint32_t X[16] = {0xee6e160d, 0xad5779fd, 0x3d5117ba, 0xc0251d32, 0x90eaaf58, 0x29b275cd, 0x9a0be4b2, 0x33528e76, 0xd140a933, 0x669b0cba, 0x336cc897, 0x0a54f594, 0x238fcdc7, 0xbb2aa4ed, 0x63eedd1d, 0xc774ef26};
	uint32_t E[16] = {0x3a700b2f, 0x6f990209, 0x03a9ebf5, 0x77baa418, 0x07052197, 0x815e9de3, 0x0bee085b, 0x79f5af31, 0x70732dfa, 0xfbfd5988, 0x89100937, 0x46fa69fe, 0x58e8ae31, 0x11fe9717, 0x1a91c555, 0xd2d8d28f};
	uint32_t M[16] = {0x93396323, 0x7d88ab73, 0x96b44b12, 0xb26f168d, 0x089fff62, 0xee90e59f, 0xbdf699bf, 0x5b256d22, 0xfbf87f88, 0x53a0b98c, 0x39a425fd, 0x2641abc1, 0x8aa0e889, 0xc9ebaa28, 0x7064a229, 0xd729c7f3};
	uint32_t R[16] = {0x6cc69cdd, 0x8277548c, 0x694bb4ed, 0x4d90e972, 0xf760009d, 0x116f1a60, 0x42096640, 0xa4da92dd, 0x04078077, 0xac5f4673, 0xc65bda02, 0xd9be543e, 0x755f1776, 0x361455d7, 0x8f9b5dd6, 0x28d6380c};
	uint32_t R2[16] = {0x72e77588, 0x71b33185, 0x2a10c349, 0xa16080bc, 0xe40ed53d, 0x43d31874, 0xbacee420, 0x806a07bf, 0xc054808f, 0x99520250, 0xd03ab28f, 0xadbe0ccc, 0x3dd91dfd, 0x9061354d, 0x75a1e9bd, 0xa1d16fd2};
	uint32_t exp_len =  512;
	uint32_t expected_output[16] = {0x211302b2, 0x361d9964, 0x4bc8f69b, 0xe86e015d, 0xb9f11705, 0x64d3c8d3, 0xae828faa, 0xb08b4415, 0x39a73358, 0xb592152a, 0x45dcc3cb, 0x86460805, 0x4efbb736, 0x50e79a93, 0x01d7d774, 0xd4084ef3};

	#elif HW_EXP_TESTVECTOR == 15
	// mod exp q of crtrsa seed 2017.2
	uint32_t X[16] = {0x684f0f0c, 0xe4e218ad, 0x3ecf55ba, 0x016617bd, 0x034036d9, 0x20eeaed0, 0x0b0c6b3b, 0x510bc9f7, 0x2613ff5b, 0x6af925b1, 0x9cc7298b, 0xf538357d, 0xae3e9e00, 0xa90a8d7f, 0x0136d858, 0x9698d99e};
	uint32_t E[16] = {0x1f2b4867, 0x7d31b53e, 0x5568aaa4, 0xdbbc22ac, 0xa6ab0555, 0xb2744204, 0xbf538ba1, 0xb15ed00b, 0x8c73019a, 0x1fa236b6, 0x948355b7, 0x681b25de, 0x4ffe779d, 0x69ce1447, 0xe78caa9c, 0x44e90c04};
	uint32_t M[16] = {0x572f98f5, 0xd066ca26, 0x4ed48ca7, 0xdc395c9d, 0x3b6a53b5, 0xe8b7f670, 0xdec0d7d2, 0x10d9dfa9, 0x6501a7ae, 0xa2cc78cc, 0xbaf57b41, 0x86e7753a, 0x5ab9d7db, 0x9198c753, 0xab9e95ec, 0xbf15eee1};
	uint32_t R[16] = {0xa8d0670b, 0x2f9935d9, 0xb12b7358, 0x23c6a362, 0xc495ac4a, 0x1748098f, 0x213f282d, 0xef262056, 0x9afe5851, 0x5d338733, 0x450a84be, 0x79188ac5, 0xa5462824, 0x6e6738ac, 0x54616a13, 0x40ea111e};
	uint32_t R2[16] = {0x4274d050, 0x031558c8, 0xb60ad0f5, 0xd26c67eb, 0x8da33eb8, 0xd3abc26b, 0xe290ae0d, 0xe070933b, 0x03fa262f, 0xeaca560b, 0x5cbfceaa, 0x798b8551, 0x5c5b2a36, 0xe63421ee, 0xe7686b30, 0xa8ec04c7};
	uint32_t exp_len =  511;
	uint32_t expected_output[16] = {0xabd36c33, 0xd241da3b, 0xccc46940, 0x17bee875, 0xecd3c107, 0xca2dd37c, 0x91a25090, 0x2f0256a7, 0x2216207e, 0x0608188b, 0x8366931e, 0x9e5ff40a, 0x8449258e, 0xccc6d948, 0xf53c031f, 0x0a568c91};


	#else /*HW_EXP_TESTVECTOR*/
	uint32_t X[16] = {0xfc38f8c6, 0xcaaaece4, 0x47c10fc1, 0x0cf6d298, 0xae207076, 0xbe9b3220, 0x6722e569, 0x6bf767c3, 0xc72d59e7, 0xa683dafb, 0x7c9add03, 0x053afee1, 0x17dc359c, 0x5d62fb27, 0xf90c67b2, 0x18480c3f};
	uint32_t E[16] = {0x00000085, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000, 0x00000000};
	uint32_t M[16] = {0x1a38ce7f, 0x668bd870, 0x45af0b65, 0xb3a91e03, 0x607b42af, 0x054ef25f, 0x6f92774d, 0x94746079, 0x9c78129d, 0x047388d0, 0x369c4d3f, 0x483299b2, 0xa20c3a44, 0xbf2cedfb, 0x9c14e1f5, 0xc01d5b60};
	uint32_t R[16] = {0xe5c73181, 0x9974278f, 0xba50f49a, 0x4c56e1fc, 0x9f84bd50, 0xfab10da0, 0x906d88b2, 0x6b8b9f86, 0x6387ed62, 0xfb8c772f, 0xc963b2c0, 0xb7cd664d, 0x5df3c5bb, 0x40d31204, 0x63eb1e0a, 0x3fe2a49f};
	uint32_t R2[16] = {0x04db6b2f, 0x00454af7, 0xcd08af38, 0xed86c171, 0xce346928, 0x41fb0dc3, 0xc9783cdb, 0x09d24e82, 0x580e9ea8, 0x283adb98, 0x2062cc70, 0x583efac4, 0x06d82796, 0x87b28dba, 0x0ce83634, 0x8a0a30b7};
	uint32_t exp_len =  8 ;
	uint32_t expected_output[16] = {0x0cea3b02, 0x83b86d3d, 0x51f4ec3b, 0x13905a1e, 0xac9e8234, 0xe778729b, 0xb2d7d004, 0xffe55a88, 0x8c9392cb, 0x3589d855, 0x9c86a0c5, 0x1745bb3e, 0x95dd6530, 0xb1732fa0, 0x9c2a0f1f, 0x279ea191};

	#endif /*HW_EXP_TESTVECTOR*/

	hw_mod_exp(X, E, exp_len, M, R, R2, result);
	printMontResult(16);
	xil_printf("Expected: \r\n");
	printArray(expected_output, 16);

	if (memcmp(result, expected_output, 16) != 0) {
		xil_printf("Hardware montgomery exp failed\r\n");
		abort();
	}

	xil_printf("Test hardware montgomery exp succeeded\r\n");

}


void test_mont_exp() {

#define EXP_TESTVECTOR 1

    #if EXP_TESTVECTOR == 1
    // message
    uint32_t X[32] = {0xd1f72277, 0x5bcebff7, 0x0f28d9ed, 0xe43362d8, 0xc5c6c315, 0x855753eb, 0xcb9978eb, 0xb04d99ad, 0x01c7c457, 0x2b5ccae1, 0x2b623a24, 0x4d9ce47f, 0x70f0f243, 0xc770f081, 0x67f34a9b, 0x18229f68, 0xdf327808, 0x00a34197, 0x0525ffdb, 0xf4b5797c, 0xdc1eed8f, 0xa115f7e8, 0x35e7960a, 0x7ec4d255, 0x7ec475ec, 0x6184c174, 0x8f3ef993, 0x0df6bbaa, 0x22928bf8, 0x6f58f75d, 0x00121ef8, 0x8736b775};
    // modulus
    uint32_t M[32]       = {0xbbfc20bd, 0x36ad0309, 0x4fae157f, 0xc4ea08c0, 0x0d37681c, 0x07e72b82, 0xf345dca3, 0x4a723f88, 0xdcf5ac59, 0x06b8a6b2, 0x368a00f3, 0xdb7d2058, 0x2c9dbb28, 0x124e2690, 0xcdd19842, 0x5ae15e97, 0xe2bda701, 0x9d11ea54, 0xe18c6fc9, 0xe0c3160c, 0xa00703b0, 0x1e21f6b5, 0xaf942238, 0xbe210e79, 0xc2ca886b, 0x6c20ecb1, 0xfcafdd9e, 0xba6224ee, 0xf80d650a, 0xd3119ff0, 0x8149d93a, 0x88c7a0f9};
    uint32_t M_prime[32] = {0x7e1f256b, 0x83dbe076, 0x6640a5e5, 0x7b9efc19, 0xcda50596, 0xd7b39c97, 0x4d8cb877, 0x3dfed80f, 0x7bc6ab2b, 0x66833e2c, 0x544cf630, 0xea63f8c9, 0x24dd3f41, 0x0ceb1ef4, 0x7cda2f92, 0xd5521efe, 0x9cf36016, 0x12fbe409, 0x46775528, 0xd346ccda, 0xb184f914, 0x981b516b, 0x75eb8385, 0x39c7425d, 0x8733bd5c, 0xd2a971df, 0x4a718971, 0x093ce057, 0xc3268d0a, 0x89da0333, 0x587151e7, 0x66edd04d};
    // encryption exponent
    uint32_t E[32] = {0x0000ef6b};
    uint32_t exp_len = 16;
    // R mod N, and R^2 mod N, (R = 2^1024)
    uint32_t R[32]  = {0x4403df43, 0xc952fcf6, 0xb051ea80, 0x3b15f73f, 0xf2c897e3, 0xf818d47d, 0x0cba235c, 0xb58dc077, 0x230a53a6, 0xf947594d, 0xc975ff0c, 0x2482dfa7, 0xd36244d7, 0xedb1d96f, 0x322e67bd, 0xa51ea168, 0x1d4258fe, 0x62ee15ab, 0x1e739036, 0x1f3ce9f3, 0x5ff8fc4f, 0xe1de094a, 0x506bddc7, 0x41def186, 0x3d357794, 0x93df134e, 0x03502261, 0x459ddb11, 0x07f29af5, 0x2cee600f, 0x7eb626c5, 0x77385f06};
    uint32_t R2[32] = {0x22f47dee, 0xf5713476, 0x1cd271a5, 0xcaef844d, 0xe4dfe69e, 0x21310383, 0xa8d683ed, 0x8e3dafe0, 0x3850d425, 0xddd8c78f, 0x027ebe51, 0x69522c83, 0x5b87bdca, 0xed6b9fdd, 0x0a4a4a0b, 0x40e5cf13, 0xe01dc8cc, 0x2d59d31b, 0x48725aa8, 0x4042e36e, 0x9c136c2a, 0xff5afff6, 0xad2bbbce, 0x4805f182, 0x0f651f17, 0x07ba3e74, 0xb04591cf, 0x196464b7, 0x48754ce6, 0xe0983de5, 0x2e4875f2, 0x1356d001};
    uint32_t expected_output[32] = {0x06330823, 0xa8da499b, 0x7adae76a, 0xb8f64269, 0x3d6586b7, 0x59e065e8, 0x19a5670e, 0x883da67d, 0x800ae2b3, 0xb7386f60, 0x24721d27, 0x728e69da, 0xea509ffe, 0x45d521f1, 0x013ed688, 0x4c6ec24d, 0xc84323e9, 0xd271a4e2, 0x4480c8ef, 0x9b9ff918, 0x74d142e6, 0xf6a8061c, 0x18f37e45, 0x2786c35d, 0xa5d51ea9, 0x11ae0a3e, 0xdaf958c9, 0x34cd83ff, 0x8eef0f98, 0x8445fc71, 0xee2a38b5, 0x780946ec};

	#elif EXP_TESTVECTOR == 2
	uint32_t X[32] = {0xa1f9b6ce, 0xb2280607, 0x24236d19, 0x893c1d9f, 0xbba1e702, 0x889c65d7, 0x463c0845, 0x14dd5add, 0x95f2bdc1, 0x0544a782, 0xac7e26cc, 0x809595e4, 0x5ad6974d, 0x66fcb060, 0x2e36800a, 0x5a3df073, 0x519a860e, 0x7ed1d6a5, 0x2163f769, 0xc4d86c58, 0xd433da74, 0x4b5bcd6a, 0xede84ee3, 0x7eaf5dcb, 0xb2493458, 0x4ab389f4, 0xddfe0216, 0x812a9f4c, 0xc87937ee, 0xcf32f14e, 0xe18435a4, 0x90541eab};
	uint32_t M[32] = {0x4e6fc30b, 0x6d5f9033, 0x3ac93d69, 0x415df9fb, 0xd9652e87, 0x60a7aef2, 0x44b77c4d, 0x847fc030, 0x5cf21cd5, 0x535736da, 0x46ae1b11, 0xfddff04c, 0x84fd9c4b, 0x08cac904, 0x34a95116, 0x49fff604, 0xede53570, 0xbb09ad2c, 0xce07019a, 0x77d3b920, 0x06f3fbd7, 0x8fe6df35, 0xfce4611e, 0xf5072bc5, 0xaf3847f7, 0x2740a725, 0x90ecf0ea, 0x9389ce5e, 0x4e2e474e, 0x66f610cd, 0xac41f79a, 0x960979f7};
	uint32_t M_prime[32] = {0xb2398f5d, 0xe8bb9fa4, 0xa8dee45f, 0xb6e49a9a, 0x652d0405, 0xc9b0505c, 0x5c660752, 0x215439c4, 0xff8acd11, 0x580531cb, 0xed14607e, 0x09737250, 0x3795d3f1, 0x0dcb6f6a, 0x9fbf5fd0, 0xd250464a, 0xa02b3a11, 0xbcbf929b, 0x6e7770a4, 0x36c76dad, 0x1745e15d, 0xaf29ebac, 0xce6ec197, 0xcb747bf7, 0x3df912a0, 0xc5836e88, 0xa3832d3e, 0xad7925cc, 0xc160b4e9, 0xa7e9e3fe, 0x51356d8a, 0x20ef8590};
	uint32_t E[32] = {0x0000e417};
	uint32_t exp_len = 16;
	uint32_t R[32]  = {0xb1903cf5, 0x92a06fcc, 0xc536c296, 0xbea20604, 0x269ad178, 0x9f58510d, 0xbb4883b2, 0x7b803fcf, 0xa30de32a, 0xaca8c925, 0xb951e4ee, 0x02200fb3, 0x7b0263b4, 0xf73536fb, 0xcb56aee9, 0xb60009fb, 0x121aca8f, 0x44f652d3, 0x31f8fe65, 0x882c46df, 0xf90c0428, 0x701920ca, 0x031b9ee1, 0x0af8d43a, 0x50c7b808, 0xd8bf58da, 0x6f130f15, 0x6c7631a1, 0xb1d1b8b1, 0x9909ef32, 0x53be0865, 0x69f68608};
	uint32_t R2[32] = {0xafd67099, 0x1057b974, 0x5b5f30e3, 0x8abf56c9, 0x15aead5f, 0x007f37b8, 0xfc5e5375, 0xf354bc3d, 0x93f5cbd3, 0x129b3c53, 0xb185bce7, 0x553b5c6a, 0x69611f46, 0xaa095a06, 0xb1eaf678, 0x3b7bc563, 0xd0c17574, 0x10d9a47d, 0xd2346905, 0xc2c5d097, 0x1618fbe4, 0xf09131ef, 0x80173e25, 0x4eecd25c, 0xf05880a3, 0xfcd0e1aa, 0xb0be348f, 0x89353122, 0x49baf1b4, 0x9278de2c, 0x38832c11, 0x7263314d};
	uint32_t expected_output[32] = {0xab568cab, 0x8788884c, 0x73fc522c, 0x9089f061, 0xaa5f4254, 0xc0d32f7d, 0x3d58b41a, 0xa00a5263, 0x67534dde, 0xb5aa830e, 0xf718b281, 0xf99b3740, 0xeba63338, 0xadfe35b0, 0x041d57c0, 0x44d17209, 0x2a43baac, 0x432ac620, 0x206adf87, 0x7df68c65, 0xfe6ecab1, 0x973fe19d, 0xf6acfca0, 0xd197e90c, 0x6fcf86f7, 0x6ca237ba, 0xcb566216, 0x3237cd3b, 0xa9e65259, 0x13600ec6, 0xfb997871, 0x51aaa340};

    #elif EXP_TESTVECTOR == 3
	uint32_t X[32] = {0x22b3b2e5, 0x855e6eeb, 0xf97c2a24, 0x858f4dce, 0x18d08bc8, 0x2d779d59, 0x8e73afa3, 0xd662a4d1, 0x69b6a28a, 0x1dbf0a01, 0x7a091f53, 0xa6a24c08, 0x63f80a76, 0x909d0d22, 0xb9a92ee1, 0xd7fbd7d3, 0x9e2749f4, 0x5e91547f, 0xb01b886a, 0x160217b4, 0x5504f213, 0x777e690f, 0x5c41564b, 0x266fea1e, 0x14266d31, 0xd6406cff, 0x58ac507f, 0xf8104dd2, 0xefb99905, 0x6765a442, 0xc3fd3412, 0xa4d1cbd5};
	uint32_t M[32] = {0x2e4a4371, 0xdf1fb2bc, 0x6d4da708, 0xe68cfda7, 0x365c1a65, 0x45bf37df, 0x0dc8b4bd, 0xa151af5f, 0xf55bccc0, 0xfaa31a4f, 0xe5644738, 0x4effd6fa, 0x219a7372, 0x98488e9c, 0x90c4bd70, 0xaccbdd7d, 0xd49b83bf, 0x24975c3c, 0xa9061123, 0x13ecb4ae, 0x2ee652c0, 0x9838ef1e, 0x75a23d18, 0x6073e286, 0x52d23b61, 0x9a6a9dca, 0xfb06a3c6, 0x52c99fbc, 0xae5d54ec, 0xde92de5e, 0xa080e01d, 0xb10b8f96};
	uint32_t M_prime[32] = {0xfaf3e26f, 0x75f08430, 0x6d8fcf12, 0xe8c5ba4b, 0x9e264809, 0xd351418a, 0x9f8b9d41, 0x6859d6be, 0xed66f277, 0xc5437adc, 0xcdd683f4, 0xbacb7c0b, 0x94e36b0a, 0x2c324f0f, 0xaa2e9ba1, 0x4fa8e2c1, 0x9ca6dcbb, 0x7de571e6, 0x24dd5717, 0xde25014d, 0x543b8e37, 0x2f0c55fa, 0x2db1fb0f, 0x320ec939, 0xa8b449b8, 0x4205c15c, 0x69554bc8, 0x388bc4a8, 0xc677c17b, 0xaa37657a, 0x91784afa, 0x51c8e809};
	uint32_t E[1] = {0x000ae417};
	uint32_t exp_len = 20;
	uint32_t R[32] = {0xd1b5bc8f, 0x20e04d43, 0x92b258f7, 0x19730258, 0xc9a3e59a, 0xba40c820, 0xf2374b42, 0x5eae50a0, 0x0aa4333f, 0x055ce5b0, 0x1a9bb8c7, 0xb1002905, 0xde658c8d, 0x67b77163, 0x6f3b428f, 0x53342282, 0x2b647c40, 0xdb68a3c3, 0x56f9eedc, 0xec134b51, 0xd119ad3f, 0x67c710e1, 0x8a5dc2e7, 0x9f8c1d79, 0xad2dc49e, 0x65956235, 0x04f95c39, 0xad366043, 0x51a2ab13, 0x216d21a1, 0x5f7f1fe2, 0x4ef47069};
	uint32_t R2[32] = {0x74aa5319, 0xc858a523, 0xb7606cc5, 0xe896dad3, 0xc46cff7c, 0xc81f66fb, 0x3888602d, 0x88a4e1b0, 0x01a1325d, 0x58e133b0, 0xee24e06c, 0x88913e20, 0xdb526dc0, 0x569160e0, 0xc675109f, 0xaa2ee84b, 0xea0736ad, 0xbbf724b4, 0x4dbd7ca7, 0xb6a3bb99, 0xba198811, 0x6ca21841, 0xe3939e0c, 0xd669f224, 0x3abd32e2, 0xc456f436, 0xd18062af, 0x8f62499e, 0xab9f57c1, 0x631df2a3, 0x9359aa23, 0xa6a24d2d};
	uint32_t expected_output[32] = {0xbe02a166, 0xe05fc340, 0x1c879fd9, 0xc4e09179, 0x60abbff5, 0x9f9bb209, 0x6af8aa61, 0xfa5e1c2d, 0x9fcf475a, 0xb3ff537b, 0xb35245b4, 0xfd212504, 0xe112e7d9, 0x5dbb498c, 0x167f7594, 0x0e83f430, 0x4cb08e2f, 0x7a10ef3d, 0x4f190a62, 0x01fa9c32, 0x0633db82, 0x19e8ddfd, 0x35e0008d, 0xc7aa4183, 0x33337b64, 0xfca5658d, 0x0134dde3, 0xb8a5b65a, 0x4a3324de, 0x86cfbed4, 0x1a039bb2, 0x1c9316ac};

    #elif EXP_TESTVECTOR == 4
	int32_t X[32] = {0x6bd93cbd, 0x2ebfb2c7, 0x7cf9e776, 0xe4187535, 0x66a33b10, 0x065afad6, 0x975f73d4, 0x496fb60b, 0x28529fbe, 0xc140401f, 0x7eeb31e2, 0xef45f639, 0xe5c0b738, 0xdb2ac5f3, 0x79802c83, 0x1f1b89c3, 0xbf7eaa58, 0xd45a55ba, 0xab819d74, 0xa6d3bd6f, 0x0482976d, 0xfec7eb1e, 0xf32906b7, 0x652d4084, 0x22033068, 0x36124322, 0x9f76d1a1, 0x6da7ec88, 0x5eacf0a4, 0xd1a8728e, 0xf8cc6ab0, 0xb02f6148};
	uint32_t E[1] = {0x0000b330};
	uint32_t exp_len =  16 ;
	uint32_t M[32] = {0xfde33b8f, 0xbaab11a1, 0x3c8c893c, 0xb1500200, 0xf9d24bba, 0xe222d5c3, 0x6cac296c, 0xb98e5642, 0x673bb3df, 0xbf622e6f, 0xcde92e10, 0x5b70b0f8, 0xbc0af8ba, 0x26111490, 0x930334b9, 0x66277177, 0x0e5f81f5, 0x7bfcaf4b, 0x8411f03a, 0xd0173f99, 0xd32ec72e, 0x53bdcc72, 0xcff9bece, 0x9aa667a9, 0x6fe3a78c, 0x02c749b4, 0xb1097967, 0x590ecd2d, 0x47583048, 0x56369bca, 0x3c5ee883, 0xd47ce65d};
	uint32_t M_prime[32] = {0xd66e7c91, 0xc5b565a8, 0x3892fdf7, 0x31ccfc2c, 0x51f3c44e, 0x4eda9428, 0x882b0045, 0x40b44298, 0x4c14c80c, 0xf7a4f863, 0xe92fdb59, 0x689b1a21, 0x5bd4d3db, 0xd2021bfd, 0xa2173bab, 0xc9273af2, 0xd4e24d7c, 0x7ecc06b8, 0x93ad0a7e, 0x2848eb92, 0xa7686bf4, 0x85ac7173, 0x7f006423, 0x8b809826, 0x7e4c1de7, 0x8089306b, 0x99b4ca40, 0x3e8b96ea, 0x39f10350, 0x1f95753a, 0xe4500b0a, 0x25fb6099};
	uint32_t R[32] = {0x021cc471, 0x4554ee5e, 0xc37376c3, 0x4eaffdff, 0x062db445, 0x1ddd2a3c, 0x9353d693, 0x4671a9bd, 0x98c44c20, 0x409dd190, 0x3216d1ef, 0xa48f4f07, 0x43f50745, 0xd9eeeb6f, 0x6cfccb46, 0x99d88e88, 0xf1a07e0a, 0x840350b4, 0x7bee0fc5, 0x2fe8c066, 0x2cd138d1, 0xac42338d, 0x30064131, 0x65599856, 0x901c5873, 0xfd38b64b, 0x4ef68698, 0xa6f132d2, 0xb8a7cfb7, 0xa9c96435, 0xc3a1177c, 0x2b8319a2};
	uint32_t R2[32] = {0x26045bb8, 0xba193d95, 0xd20814ea, 0x19a75797, 0xfca712a6, 0x6b79d071, 0x3e3ddc88, 0x5221c132, 0x3486d53b, 0xc9d8e2d6, 0xaf41e254, 0xf196b1c4, 0x684ee3c1, 0xfa842770, 0xf24bd8f3, 0x5aade81a, 0x9e241aaf, 0xb124f0d0, 0xc3eab6fa, 0x3152f477, 0x5a3b6b5a, 0xc0b611fe, 0x8b7da09a, 0xe48206a5, 0xa49d1b4d, 0x1e325d7d, 0x7bc36905, 0x53c5c413, 0x42004279, 0x474987b3, 0x0d551915, 0x79cd4e0d};
	uint32_t expected_output[32] = {0x7b8b8b2b, 0xdf418dfd, 0xbc9b9a90, 0x9045168f, 0xf9693f5b, 0x08ae73eb, 0xb6e256c8, 0x703916b2, 0x15457095, 0x0f96215f, 0x6f55556f, 0xe82e4228, 0x02e95280, 0x2cb48c54, 0x8b2ff8c6, 0xa62d1978, 0x5a164faa, 0xebb41935, 0x7ded2df9, 0x6d1e6b7b, 0x3ee1749b, 0xf5748a36, 0x35688d90, 0xf73318f4, 0x1b508ad1, 0x8c821a1f, 0x05ab6332, 0x8cc46c1f, 0x2d33f2bb, 0x66ea8c0f, 0x326fcfb7, 0x2c844669};

	#elif EXP_TESTVECTOR == 5
    uint32_t X[32] = {0x6bd93cbd, 0x2ebfb2c7, 0x7cf9e776, 0xe4187535, 0x66a33b10, 0x065afad6, 0x975f73d4, 0x496fb60b, 0x28529fbe, 0xc140401f, 0x7eeb31e2, 0xef45f639, 0xe5c0b738, 0xdb2ac5f3, 0x79802c83, 0x1f1b89c3, 0xbf7eaa58, 0xd45a55ba, 0xab819d74, 0xa6d3bd6f, 0x0482976d, 0xfec7eb1e, 0xf32906b7, 0x652d4084, 0x22033068, 0x36124322, 0x9f76d1a1, 0x6da7ec88, 0x5eacf0a4, 0xd1a8728e, 0xf8cc6ab0, 0xb02f6148};
    uint32_t E[1] = {0x00000003};
    uint32_t exp_len =  2 ;
    uint32_t M[32] = {0x3b6021e5, 0x134c079f, 0xfde33b8f, 0xbaab11a1, 0x3c8c893c, 0xb1500200, 0xf9d24bba, 0xe222d5c3, 0x6cac296c, 0xb98e5642, 0x673bb3df, 0xbf622e6f, 0xcde92e10, 0x5b70b0f8, 0xbc0af8ba, 0x26111490, 0x930334b9, 0x66277177, 0x0e5f81f5, 0x7bfcaf4b, 0x8411f03a, 0xd0173f99, 0xd32ec72e, 0x53bdcc72, 0xcff9bece, 0x9aa667a9, 0x6fe3a78c, 0x02c749b4, 0xb1097967, 0x590ecd2d, 0x47583048, 0xd6369bca};
    uint32_t M_prime[32] = {0xb7bfcc13, 0x913284a2, 0xdda7b6f2, 0x7a5c8583, 0x709ca502, 0xaa20b65c, 0xe603ebeb, 0x370f8de1, 0x6e6a026e, 0xd531c566, 0x1271e3eb, 0x732d0aed, 0x5f44d582, 0x3c5ebd20, 0x4625fb34, 0xbffb3ff7, 0x28b98ae5, 0x2fbac94d, 0xc26bafc9, 0xcae25e12, 0xb43b5053, 0x56971c37, 0x4bbeb19d, 0x0a85b251, 0x11df4432, 0xb449f6bb, 0x04e65bfb, 0x485edf78, 0x5f3c3876, 0xb7bbe9c9, 0x0734e9ad, 0x4a415b38};
    uint32_t R[32] = {0xc49fde1b, 0xecb3f860, 0x021cc470, 0x4554ee5e, 0xc37376c3, 0x4eaffdff, 0x062db445, 0x1ddd2a3c, 0x9353d693, 0x4671a9bd, 0x98c44c20, 0x409dd190, 0x3216d1ef, 0xa48f4f07, 0x43f50745, 0xd9eeeb6f, 0x6cfccb46, 0x99d88e88, 0xf1a07e0a, 0x840350b4, 0x7bee0fc5, 0x2fe8c066, 0x2cd138d1, 0xac42338d, 0x30064131, 0x65599856, 0x901c5873, 0xfd38b64b, 0x4ef68698, 0xa6f132d2, 0xb8a7cfb7, 0x29c96435};
    uint32_t R2[32] = {0xdbc1f8f5, 0xf0b21422, 0x0d5ce12d, 0x8bf6674a, 0x79da5d6c, 0x8b4c29bd, 0xd85013c5, 0xcb075991, 0x2d1b80ff, 0x1f7c5324, 0x9748937f, 0x66816f22, 0x7b5718bb, 0x81e6a3f3, 0xa2224052, 0x7c5571e1, 0x0425d5c9, 0x429c93b3, 0x82cdbd69, 0x26200729, 0x8d9e7da4, 0x0360fe11, 0x8cf166a3, 0xafcf3310, 0x00d3f832, 0x10bc759b, 0x310def28, 0x4e09dc91, 0x3508c858, 0xd2b5d271, 0x262f767d, 0x7a23eae8};
    uint32_t expected_output[32] = {0x2ce21a20, 0xcb5b9814, 0x90605b33, 0x5af59716, 0x4f07ec4e, 0x64ea8d10, 0xde81ea17, 0xc0d2aa89, 0x95da6afe, 0x0b67fed5, 0x4185b338, 0xa908a2ec, 0x82d658a6, 0x1bda310b, 0xbe5edaf9, 0xffd21728, 0xf160971e, 0xd5579fae, 0x71453ff5, 0x725784c3, 0x108131a3, 0xca63c353, 0x798a79c7, 0xf07786b1, 0x134f0a9a, 0xad1972c0, 0x28c52783, 0x31a1df14, 0xa9a52606, 0xef06cd59, 0x226a15b4, 0x6d039b24};

	#else // EXP_TESTVECTOR == 6
    uint32_t X[32] = {0x5204a0f4, 0x471df4bc, 0x2943dabc, 0xb33cf03c, 0x6c3700c0, 0x9c2e40a2, 0x6adfcf1e, 0x6ea31cc6, 0x54640571, 0x251b5eac, 0x783b7589, 0x473fe47b, 0xe36d9e78, 0x57153d0b, 0x8696b918, 0x1a4fd6c0, 0x4c3a0ab4, 0xd663800e, 0xe6c7efa5, 0xe773fa73, 0x98419280, 0x65441264, 0x6a749096, 0x320a57ae, 0xbfe4daaa, 0x229ec3a6, 0x60a6aee8, 0x68dac070, 0xb3d00628, 0xd7a3120a, 0xb02aa62c, 0x90f35c6d};
    uint32_t E[1] = {0x00000003};
    uint32_t exp_len =  3 ;
    uint32_t M[32] = {0x0ef31747, 0xf3d8b0d7, 0xa8de9738, 0xece35114, 0xe0643aba, 0x46dd62bd, 0xc2005261, 0xe1e83167, 0xa50b0b7c, 0xb6c38903, 0x609f2ad9, 0x310a9fc2, 0x5bee620f, 0x1ff62a17, 0x6ff4d2bd, 0x10e5d3fb, 0xe4df395b, 0xa78de346, 0x10213dc3, 0xea1ac1ed, 0xd458eb04, 0xe438c468, 0x28800b75, 0x02ec2efe, 0xd24f68c9, 0xb8e75ae3, 0x9f7c00eb, 0xcb45d78b, 0x38ec9502, 0x474556ce, 0x0cf424ed, 0xe4f390d5};
    uint32_t M_prime[32] = {0x154e9d89, 0xfd21221c, 0xea40621f, 0x9d2592ca, 0xdb2dfd37, 0xa1b3cca1, 0xd0d37e5b, 0x519b0a73, 0x332094ae, 0x2c6de6a8, 0x5baabe3e, 0xb58420e1, 0xd6198fb8, 0x5fd0a147, 0x685f43bd, 0x463668d0, 0xe203c9e0, 0x45d53656, 0x2413e640, 0x54bc3a78, 0x82fcabaa, 0x02808516, 0x92876bb3, 0x27ad12d7, 0x0d03d700, 0x147dcbd1, 0x47f0325f, 0x7ad15049, 0x26b7ce29, 0xcda191e3, 0x5ce38f4d, 0x2449ee60};
    uint32_t R[32] = {0xf10ce8b9, 0x0c274f28, 0x572168c7, 0x131caeeb, 0x1f9bc545, 0xb9229d42, 0x3dffad9e, 0x1e17ce98, 0x5af4f483, 0x493c76fc, 0x9f60d526, 0xcef5603d, 0xa4119df0, 0xe009d5e8, 0x900b2d42, 0xef1a2c04, 0x1b20c6a4, 0x58721cb9, 0xefdec23c, 0x15e53e12, 0x2ba714fb, 0x1bc73b97, 0xd77ff48a, 0xfd13d101, 0x2db09736, 0x4718a51c, 0x6083ff14, 0x34ba2874, 0xc7136afd, 0xb8baa931, 0xf30bdb12, 0x1b0c6f2a};
    uint32_t R2[32] = {0x8f64843f, 0x5175009b, 0x19d49251, 0x9db2b2bc, 0x01895be9, 0x791a5d68, 0xf27e294d, 0xcdd27b1e, 0x31f7003c, 0x92caf811, 0x5cbce177, 0xec50ef16, 0x32570b0e, 0x2f099ce6, 0xb7899400, 0x5171f544, 0x9fde17a7, 0x8a9f7b58, 0x3c6448df, 0x3955c76c, 0xb3997a51, 0x225212bf, 0x3d4d276b, 0x7eb5f44e, 0x8dcdac09, 0x7c9a75cb, 0xc84bef22, 0x017050c7, 0xe3b95aae, 0x5dba2812, 0x2f27c903, 0x8ad3e22c};
    uint32_t expected_output[32] = {0x605d5def, 0x3bd4b0bb, 0x5e4f8e7d, 0x58c4ba04, 0x9f51fc53, 0xd2c7171a, 0x3f6ebaba, 0x4936915a, 0xcb2b8c88, 0x5c3b2b45, 0x35f3331b, 0x0022c7b3, 0xd7f12aa0, 0x1ddb9c32, 0x0a3cdfa7, 0x203142ec, 0x76592cca, 0x17cd037e, 0x7c60c0b5, 0x57723806, 0x8cd291c2, 0xc4111f92, 0x9be3cd93, 0x5610a1a7, 0x3bd0c778, 0x48b723b5, 0x2034c6e4, 0x79c82cfe, 0xad6997ed, 0x85d25a75, 0x54c4b7ea, 0x8aab9d60};

    #endif

	mod_exp(X, E, exp_len, M, M_prime, R, R2, result);

	xil_printf("\r\n");
	printMontResult(32);
	xil_printf("Expected ");
	printArray(expected_output, 32);

	if (memcmp(result, expected_output, 32) != 0) {
		xil_printf("Software montgomery exp failed\r\n");
		abort();
	}

	xil_printf("Test software montgomery exp succeeded\r\n");

}


void test_reduce_cipher() {

	unsigned int Cp[16];
	unsigned int Cq[16];
	reduce_cipher((unsigned int*)Ciphertext, Cp, Cq);

	xil_printf("Ciphertext_p ");
	printArray((uint32_t*)Cp, 16);
	xil_printf("Expected: ");
	printArray((uint32_t*)Ciphertext_p, 16);

	if (memcmp(Cp, Ciphertext_p, 16) != 0) {
		xil_printf("Reduction failed p\r\n");
		abort();
	}

	xil_printf("Ciphertext_q ");
	printArray((uint32_t*)Cq, 16);
	xil_printf("Expected: ");
	printArray((uint32_t*)Ciphertext_q, 16);

	if (memcmp(Cq, Ciphertext_q, 16) != 0) {
		xil_printf("Reduction failed q\r\n");
		abort();
	}

	xil_printf("Reduction succeeded\r\n");
}

void test_combine_result() {

	combineResult(Plaintext_p, Plaintext_q, result);

	xil_printf("\r\n");
	printMontResult(32);
	xil_printf("Expected ");
	printArray(Plaintext, 32);

	if (memcmp(result, Plaintext, 32) != 0) {
		xil_printf("Combine result failed\r\n");
		abort();
	}

	xil_printf("Combine result succeeded\r\n");
}

void test_hw_mont_decrypt() {

	unsigned int Cp[32] = {0};
	unsigned int Cq[32] = {0};
	uint32_t Pp[32] = {0};
	uint32_t Pq[32] = {0};
	reduce_cipher((unsigned int*)Ciphertext, Cp, Cq);

	//xil_printf("Cp: ");
	//printArray((uint32_t*)Cp, 16);

	if (memcmp(Cp, Ciphertext_p, 16) != 0) {
		xil_printf("Reduction failed p\r\n");
		abort();
	}

	//xil_printf("Cq :");
	//printArray((uint32_t*)Cq, 16);

	if (memcmp(Cq, Ciphertext_q, 16) != 0) {
		xil_printf("Reduction failed q\r\n");
		abort();
	}

	uint32_t *nCp = (uint32_t*)Cp;
	uint32_t *nCq = (uint32_t*)Cq;
	hw_mod_exp(nCp, d_p, d_p_len, p, Rp, R2p, Pp);
	hw_mod_exp(nCq, d_q, d_q_len, q, Rq, R2q, Pq);

	//xil_printf("Pp: ");
	//printArray(Pp, 16);

	if (memcmp(Pp, Plaintext_p, 16) != 0) {
		xil_printf("Hardware montgomery exp p failed\r\n");
		abort();
	}

	//xil_printf("Pq: ");
	//printArray(Pq, 16);

	xil_printf("Expected: ");
	printArray(Plaintext_q, 16);
	if (memcmp(Pq, Plaintext_q, 16) != 0) {
		xil_printf("Hardware montgomery exp q failed\r\n");
		abort();
	}

	combineResult(Pp, Pq, result);

	xil_printf("\r\n");
	printMontResult(32);
	xil_printf("Expected ");
	printArray(Plaintext, 32);

	if (memcmp(result, Plaintext, 32) != 0) {
		xil_printf("Montgomery decrypt failed\r\n");
		abort();
	}

	xil_printf("Montgomery decrypt succeeded\r\n");
}

void printMontResult(uint32_t size)
{
	int i;
	if (result[size-1] != 0) {
		xil_printf("Result:0x%x", result[size-1]);
	} else {
		xil_printf("Result: 0x");
	}
	for (i=size-2; i>=0; i--) {
		xil_printf("%08x", result[i]);
	}
	xil_printf("\n\r \n\r");
}
